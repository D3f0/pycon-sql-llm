{
 "cells": [
  {
   "cell_type": "raw",
   "id": "30a6c7ba",
   "metadata": {},
   "source": [
    "---\n",
    "title: 'üí¨ {{< bi database >}} ü§ñ Asking questions to your database with LLMs '\n",
    "author: Nahuel Defoss√© {{< bi envelope >}} [nahuel.defosse@ibm.com](mailto:nahuel.defosse@ibm.com)<br>IBM Research Africa\n",
    "embed-resources: false\n",
    "footer: '*Asking question to {{< bi database >}} with LLMs* - üêç PyCon üá∞üá™ 2025'\n",
    "execute:\n",
    "  cache: true\n",
    "  keep-ipynb: true\n",
    "format:\n",
    "  revealjs:\n",
    "    toc: false\n",
    "    toc-depth: 1\n",
    "    slide-number: true\n",
    "    transition: slide\n",
    "    code-copy: true\n",
    "    highlight-style: a11y\n",
    "    code-overflow: wrap\n",
    "    theme:\n",
    "      - solarized\n",
    "      - custom.scss\n",
    "    header-logo-right: ./img/logo.svg\n",
    "    header-logo-right-size: 20px\n",
    "    header-logo-left: ''\n",
    "    preview-links: auto\n",
    "filters:\n",
    "  - reveal-logo\n",
    "  - include-code-files\n",
    "---"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "0edf50ec",
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "os.environ[\"JUPYTER_COLUMNS\"] = \"80\"\n",
    "# %load_ext rich"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "41e3bc87",
   "metadata": {},
   "source": [
    "## About myself {.smaller}\n",
    "\n",
    ":::: {.columns}\n",
    "::: {.column width=\"40%\"}\n",
    ":::: {.content-visible when-format=\"html\"}\n",
    "![](./img/memes/myself.gif){height=\"12em\"}\n",
    "::::\n",
    ":::\n",
    "\n",
    "::: {.column width=\"60%\"}\n",
    "\n",
    "::: {.incremental}\n",
    "- üêç Pythonista with 18 years of experience üá¶üá∑ üßâ\n",
    "  - Co-organized SciPy Latin America\n",
    "  - PyCon Argentina and EuroPython speaker\n",
    "- üöú Worked as CTO in  Hello Tractor \n",
    "- üß™ Software Engineer at IBM Research \n",
    "- üõ∞Ô∏è Worked in [Foundational Models for Geospatial applications {{< bi link >}}](https://www.earthdata.nasa.gov/news/nasa-ibm-openly-release-geospatial-ai-foundation-model-nasa-earth-observation-data)\n",
    "- üí¨ Currently working on [Flowpilot {{< bi link >}}](https://research.ibm.com/projects/flowpilot), providing core features to \n",
    "  different products and divisions\n",
    "::: \n",
    "\n",
    ":::\n",
    "::::\n",
    "\n",
    "---\n",
    "\n",
    "::: {.content-visible when-format=\"html\"}\n",
    "\n",
    "## Tomorrow {.center}\n",
    "\n",
    "::: {.columns}\n",
    "::: {.column width=\"30%\"}\n",
    "![](./img/promo/wanjiru.jpg)\n",
    ":::\n",
    "::: {.column width=\"30%\"}\n",
    "![](./img/promo/beldine.jpg)\n",
    ":::\n",
    "::: {.column width=\"30%\"}\n",
    "![](./img/promo/reggie.png)\n",
    ":::\n",
    "::: \n",
    "\n",
    "Learn about [Multimodal Geospatial Foundation Models with Terratorch](https://pycon-kenya-2025.sessionize.com/session/954933){target=\"_blank\"}\n",
    " by Wanjiru, Beldine and Reggie\n",
    "\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "::: {.content-visible when-format=\"html\"}\n",
    "\n",
    "## Follow along (or at üè°) {.center}\n",
    "\n",
    "::: {.columns}\n",
    "::: {.column}\n",
    "::: {style=\"text-align: center;\"}\n",
    "<a href=\"https://d3f0.github.io/pycon-sql-llm/slides.html#/title-slide\" target=\"_blank\">\n",
    "\n",
    "{{< qrcode https://d3f0.github.io/pycon-sql-llm/slides.html#/title-slide qr1 width=400 height=400 colorDark='#0011bb' >}}\n",
    "\n",
    "</a>\n",
    "\n",
    "Get the slides {{< bi arrow-up-circle >}}\n",
    ":::\n",
    "\n",
    ":::\n",
    "::: {.column}\n",
    "::: {style=\"font-size: .67em\"}\n",
    "Get the code {{< bi arrow-down-circle >}}\n",
    "\n",
    "[{{< bi github >}} https://github.com/D3f0/pycon-sql-llm](https://github.com/D3f0/pycon-sql-llm)\n",
    ":::\n",
    ":::\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "# Agenda\n",
    "\n",
    "In this talk we're gonna show how to use Python to:\n",
    "\n",
    "  - {{< bi database >}} Connect to a database and execute the queries\n",
    "  - {{< bi filetype-sql >}} Convert natural language questions into SQL\n",
    "  - {{< bi diagram-3 >}} Create a workflow\n",
    "  - {{< bi database-gear >}} Managing configuration\n",
    "  - {{< bi bookmark-check >}} Lessons learned\n",
    "\n",
    "---\n",
    "\n",
    "## Pipeline Overview\n",
    "\n",
    "![](./img/LLMsSQL.svg)\n",
    "\n",
    "\n",
    "\n",
    "---\n",
    "\n",
    "# DB Inspection\n",
    "<!-- ## Connect to a database and execute the queries -->\n",
    "\n",
    "---\n",
    "\n",
    "### Public datasets used in text to SQL\n",
    "\n",
    ":::: {.columns}\n",
    "\n",
    "::: {.column}\n",
    "::: {.fragment .fade-left .small_text}\n",
    "These datasets define:\n",
    "\n",
    "- ‚ùì Natural language questions\n",
    "- ü§ûüèΩ Expected SQL\n",
    "- üèóÔ∏è Database schema & content\n",
    "- üîé Evaluation metrics \n",
    "- ü•á Leaderboard\n",
    ":::\n",
    ":::\n",
    "\n",
    "::: {.column}\n",
    "\n",
    "::: {.fragment .fade-right}\n",
    "- [üï∑Ô∏è Spider](https://yale-lily.github.io/spider){target=\"_bank\"}\n",
    ":::\n",
    "::: {.fragment .fade-right}\n",
    "- [üï∑Ô∏è üï∑Ô∏è Spider 2](https://spider2-sql.github.io/){target=\"_bank\"}\n",
    ":::\n",
    "::: {.fragment .fade-right}\n",
    "- üê¶ [BIRD](https://bird-bench.github.io/){target=\"_bank\"}\n",
    ":::\n",
    "::: {.fragment .fade-right}\n",
    "- [üèπ Archer](https://sig4kg.github.io/archer-bench/){target=\"_bank\"}\n",
    ":::\n",
    ":::\n",
    "\n",
    "::::\n",
    "\n",
    "\n",
    "::: notes\n",
    "There are various academic datasets that are used for advancing the field\n",
    "of text2sql.\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "## BIRD \n",
    "\n",
    "![[IBM Research in the leaderboard last year](https://research.ibm.com/blog/granite-LLM-text-to-SQL)](./img/ibm-granite-leaderboard.png){height=\"400px\" fig-align=\"center\"}\n",
    "\n",
    "\n",
    "::: notes\n",
    "We're select BIRD dataset since we have some experience with it, we managed\n",
    "to get to the top of the leatherboard in 2024/6\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "### BIRD mini-dev\n",
    "\n",
    "- It consist of 500 queries classified as **simple**, **moderate** and **challenging** [{{< bi box-arrow-up-right >}}](https://github.com/bird-bench/mini_dev)\n",
    "\n",
    "::: {.fragment .fade-left}\n",
    "\n",
    "<!-- Setup cell without output with imports -->"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "230af5e9",
   "metadata": {},
   "outputs": [],
   "source": [
    "from rich.console import Console\n",
    "_c = Console(width=45)\n",
    "# Ensure print are contained within the range\n",
    "print = _c.print\n",
    "\n",
    "\n",
    "from IPython.display import display, Image"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "357025fe",
   "metadata": {
    "output-location": "slide"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>db_id</th>\n",
       "      <th>question</th>\n",
       "      <th>evidence</th>\n",
       "      <th>SQL</th>\n",
       "      <th>difficulty</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>190</th>\n",
       "      <td>formula_1</td>\n",
       "      <td>For the constructor which got the highest poin...</td>\n",
       "      <td>race number refers to raceId; constructor whic...</td>\n",
       "      <td>SELECT T2.url FROM constructorResults AS T1 IN...</td>\n",
       "      <td>moderate</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>267</th>\n",
       "      <td>superhero</td>\n",
       "      <td>In superheroes with height between 150 to 180,...</td>\n",
       "      <td>height between 150 to 180 refers to height_cm ...</td>\n",
       "      <td>SELECT CAST(COUNT(CASE WHEN T2.publisher_name ...</td>\n",
       "      <td>challenging</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>457</th>\n",
       "      <td>california_schools</td>\n",
       "      <td>What is the monthly average number of schools ...</td>\n",
       "      <td>Elementary School District refers to DOC = 52;...</td>\n",
       "      <td>SELECT CAST(COUNT(School) AS REAL) / 12 FROM s...</td>\n",
       "      <td>moderate</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>263</th>\n",
       "      <td>superhero</td>\n",
       "      <td>What is the average weight of all female super...</td>\n",
       "      <td>female refers to gender = 'Female'; average we...</td>\n",
       "      <td>SELECT AVG(T1.weight_kg) FROM superhero AS T1 ...</td>\n",
       "      <td>simple</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>159</th>\n",
       "      <td>european_football_2</td>\n",
       "      <td>When was the first time did Kevin Constant hav...</td>\n",
       "      <td>Kevin Constant refers to player_name = 'Kevin ...</td>\n",
       "      <td>SELECT `date` FROM ( SELECT t2.crossing, t2.`d...</td>\n",
       "      <td>moderate</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                   db_id                                           question  \\\n",
       "190            formula_1  For the constructor which got the highest poin...   \n",
       "267            superhero  In superheroes with height between 150 to 180,...   \n",
       "457   california_schools  What is the monthly average number of schools ...   \n",
       "263            superhero  What is the average weight of all female super...   \n",
       "159  european_football_2  When was the first time did Kevin Constant hav...   \n",
       "\n",
       "                                              evidence  \\\n",
       "190  race number refers to raceId; constructor whic...   \n",
       "267  height between 150 to 180 refers to height_cm ...   \n",
       "457  Elementary School District refers to DOC = 52;...   \n",
       "263  female refers to gender = 'Female'; average we...   \n",
       "159  Kevin Constant refers to player_name = 'Kevin ...   \n",
       "\n",
       "                                                   SQL   difficulty  \n",
       "190  SELECT T2.url FROM constructorResults AS T1 IN...     moderate  \n",
       "267  SELECT CAST(COUNT(CASE WHEN T2.publisher_name ...  challenging  \n",
       "457  SELECT CAST(COUNT(School) AS REAL) / 12 FROM s...     moderate  \n",
       "263  SELECT AVG(T1.weight_kg) FROM superhero AS T1 ...       simple  \n",
       "159  SELECT `date` FROM ( SELECT t2.crossing, t2.`d...     moderate  "
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "#| echo: true\n",
    "from datasets import load_dataset, DownloadConfig \n",
    "\n",
    "# Load the dataset\n",
    "dataset = load_dataset(\n",
    "  \"birdsql/bird_mini_dev\", \n",
    "  download_config=DownloadConfig(disable_tqdm=True)\n",
    ")\n",
    "\n",
    "# Only SQLite (there's Postgres and MySQL in the same dataset)\n",
    "sqlite_df = (dataset[\"mini_dev_sqlite\"]\n",
    "  .to_pandas()\n",
    "  .pipe(lambda df: df.drop(columns=['question_id'])))\n",
    "display(sqlite_df.sample(5, random_state=17))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f4341bf1",
   "metadata": {},
   "source": [
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "### Downloading BIRD databases\n",
    "\n",
    "<!-- - We will be using [`uvx`](https://docs.astral.sh/uv/concepts/tools/#tool-versions)[^uvx] with the `gdown` package as follows: -->\n",
    "\n",
    "```shell\n",
    "uvx gdown https://drive.google.com/file/d/13VLWIwpw5E3d5DUkMvzw7hvHE67a4XkG/\n",
    "```\n",
    "![](./img/download_minidev.png)\n",
    "<!-- Or just download from the [ {{< bi google >}} {{< bi hdd >}} link](https://drive.google.com/file/d/13VLWIwpw5E3d5DUkMvzw7hvHE67a4XkG/view?usp=sharing)  -->\n",
    "\n",
    "Extracting the archive (3.3GiB)\n",
    "\n",
    "```shell\n",
    "unzip minidev_703.zip\n",
    "```\n",
    "<!-- [^uvx]: It comes as part of `uv`, it's a shorthand for `uv tool run` -->\n",
    "\n",
    "::: footer\n",
    "The dataset doesn't contain the SQL flies, these are shared separately as zipfiles. \n",
    "In this case it's located in Google Drive.\n",
    ":::\n",
    "---\n",
    "\n",
    "### Picking the example database `california_schools`\n",
    "\n",
    "In `minidev/MINIDEV/dev_databases/california_schools/` we find the {{< bi database >}} {{< bi file >}}\n",
    "\n",
    "![](./img/california_school.png)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "7b98b3ef",
   "metadata": {},
   "outputs": [],
   "source": [
    "#| echo: true\n",
    "#| code-overflow: wrap\n",
    "from pathlib import Path\n",
    "base = Path('./minidev/MINIDEV/dev_databases/california_schools/')"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d7dd1d47",
   "metadata": {},
   "source": [
    "---\n",
    "\n",
    "## ER of `california_schools` {{< bi database >}}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "34ccd5c2",
   "metadata": {},
   "outputs": [],
   "source": [
    "#from eralchemy import render_er\n",
    "#render_er(db_url, './img/output/erd_from_sqlite.svg')"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f084a33c",
   "metadata": {},
   "source": [
    "![](./img/er-california-schools.png){.lightbox}\n",
    "\n",
    "::: footer\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "\n",
    "### Creating the `Engine`\n",
    "\n",
    "Creating an `Engine` instance connected to a SQLite database to run our queries."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "7d12705d",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Engine(sqlite:///minidev/MINIDEV/dev_databases/california_schools/california_schools.sqlite)"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#| echo: true\n",
    "#| code-overflow: wrap\n",
    "\n",
    "from sqlalchemy import create_engine\n",
    "db_path = base / 'california_schools.sqlite'\n",
    "db_url = f\"sqlite:///{db_path}\"\n",
    "engine = create_engine(db_url)\n",
    "engine"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c05eba29",
   "metadata": {},
   "source": [
    "::: notes\n",
    "This allows us to execute, manage transactions and do database introspection.\n",
    ":::\n",
    "\n",
    "\n",
    "---\n",
    "\n",
    "### Getting one simple question "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "f1f4b9fd",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>question</th>\n",
       "      <th>evidence</th>\n",
       "      <th>SQL</th>\n",
       "      <th>difficulty</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>db_id</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>california_schools</th>\n",
       "      <td>How many schools with an average score in Math...</td>\n",
       "      <td>Exclusively virtual refers to Virtual = 'F'</td>\n",
       "      <td>SELECT COUNT(DISTINCT T2.School) FROM satscore...</td>\n",
       "      <td>simple</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>california_schools</th>\n",
       "      <td>Please list the codes of the schools with a to...</td>\n",
       "      <td>Total enrollment can be represented by `Enroll...</td>\n",
       "      <td>SELECT T2.CDSCode FROM schools AS T1 INNER JOI...</td>\n",
       "      <td>simple</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                                             question  \\\n",
       "db_id                                                                   \n",
       "california_schools  How many schools with an average score in Math...   \n",
       "california_schools  Please list the codes of the schools with a to...   \n",
       "\n",
       "                                                             evidence  \\\n",
       "db_id                                                                   \n",
       "california_schools        Exclusively virtual refers to Virtual = 'F'   \n",
       "california_schools  Total enrollment can be represented by `Enroll...   \n",
       "\n",
       "                                                                  SQL  \\\n",
       "db_id                                                                   \n",
       "california_schools  SELECT COUNT(DISTINCT T2.School) FROM satscore...   \n",
       "california_schools  SELECT T2.CDSCode FROM schools AS T1 INNER JOI...   \n",
       "\n",
       "                   difficulty  \n",
       "db_id                          \n",
       "california_schools     simple  \n",
       "california_schools     simple  "
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#| echo: true\n",
    "simple_queries_df = (sqlite_df\n",
    "  .pipe(lambda df: df[df.db_id == 'california_schools'])\n",
    "  .pipe(lambda df: df[df.difficulty == 'simple']))\n",
    "\n",
    "simple_queries_df.head(2).set_index(\"db_id\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dee0be3e",
   "metadata": {},
   "source": [
    "---\n",
    "\n",
    "### Getting a `simple` question and query"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "2bbe5787",
   "metadata": {},
   "outputs": [],
   "source": [
    "#| echo: false\n",
    "import pandas as pd\n",
    "pd.set_option('display.max_colwidth', 0)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "0fee623a",
   "metadata": {},
   "outputs": [],
   "source": [
    "#| echo: true\n",
    "\n",
    "\n",
    "question_sql_df = (simple_queries_df\n",
    "  .pipe(lambda df: df[[\"question\", \"SQL\"]])\n",
    "  .reset_index())"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "bfe2f69f",
   "metadata": {},
   "source": [
    "::: {.fragment .fade-left}\n",
    "Let's take a look at the `question` and `SQL` column"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "9fea2cb7",
   "metadata": {
    "output-location": "fragment"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'How many schools with an average score in Math greater than 400 in the SAT test are exclusively virtual?'"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/plain": [
       "\"SELECT COUNT(DISTINCT T2.School) FROM satscores AS T1 INNER JOIN schools AS T2 ON T1.cds = T2.CDSCode WHERE T2.Virtual = 'F' AND T1.AvgScrMath > 400\""
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "#| echo: true\n",
    "\n",
    "question, query = question_sql_df.loc[\n",
    "  0, \n",
    "  [\"question\", \"SQL\"]]\n",
    "display(question, query)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b4fe5178",
   "metadata": {},
   "source": [
    ":::\n",
    "\n",
    "::: notes\n",
    "This is one of the valid SQL queries for this question\n",
    "There may be other. When we're comparing performance, \n",
    "in situations where we have multiple rows and there\n",
    "are no aggregations we need to decide wether the order is important or not\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "### Execute the query {.smaller}\n",
    "\n",
    "::: {style=\"font-size: 60%;\"}\n",
    "Now we run the `SQL` column captured in the variable `query` through SQLAlchemy and\n",
    "plot the results as a DataFrame\n",
    ":::"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "54863262",
   "metadata": {
    "output-location": "fragment"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>COUNT(DISTINCT T2.School)</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   COUNT(DISTINCT T2.School)\n",
       "0  4                        "
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "#| echo: true\n",
    "\n",
    "from sqlalchemy import text\n",
    "with engine.connect() as conn:\n",
    "    result = conn.execute(text(query))\n",
    "    res_df = pd.DataFrame(result.fetchall()) # üêº ‚ú®\n",
    "    display(res_df)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "59638950",
   "metadata": {},
   "source": [
    "::: footer\n",
    ":::\n",
    "\n",
    "\n",
    "---\n",
    "\n",
    "# Convert natural language questions into SQL {.smaller}\n",
    "\n",
    "---\n",
    "\n",
    "![](./img/LLMsSQL.svg)\n",
    "\n",
    "---\n",
    "\n",
    "## Coding models\n",
    "\n",
    ":::: {.columns}\n",
    "::: {.column}\n",
    "::: {.fragment .fade-left}\n",
    "LLMs are quite capable of writing functional SQL queries, from the named `code`/`coder`\n",
    "to specific ones for (`sql`) generation.\n",
    ":::\n",
    "\n",
    ":::\n",
    "\n",
    "::: {.column}\n",
    "\n",
    "::: {.fragment .fade-left}\n",
    "For example, some IBM trained models include:\n",
    "\n",
    "- granite-3-2-8b-instruct\n",
    "- granite-34b-code-instruct\n",
    "- granite-20b-code-base-schema-linking\n",
    "- granite-20b-code-base-sql-gen\n",
    "\n",
    "[More info on these models {{< bi box-arrow-up-right >}}](https://dataplatform.cloud.ibm.com/docs/content/wsj/analyze-data/fm-models-ibm.html?context=wx&locale=en&audience=wdp#granite-code-instruct-models) | \n",
    "[And also in ü§ó {{< bi box-arrow-up-right >}}](https://huggingface.co/models?search=sql)\n",
    "\n",
    ":::\n",
    "\n",
    ":::\n",
    "\n",
    "::::\n",
    "\n",
    "::: notes\n",
    "For those of us who have been writing code for some time and \n",
    "fell in love with ORMs when they were the *hot* new thing, LLMs\n",
    "can take us to the next level!\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "## Prompts for SQL generation {transition=\"convex\"}\n",
    "\n",
    "\n",
    "::: {.fragment .fade-in-then-semi-out}\n",
    "LLMs don't know the  üèóÔ∏è structure of our database, and may hallucinate \n",
    "about it, or create some flat out invalid SQL\n",
    ":::\n",
    "\n",
    "::: {.fragment .fade-in-then-semi-out}\n",
    "We have to  provide __extra__ information about the structure in the instructions\n",
    "\n",
    "For this we will use a **prompt** string with some placeholders {{< bi braces >}}.\n",
    ":::\n",
    "\n",
    "::: {.fragment .fade-in-then-semi-out .small}\n",
    "Some research papers from our team on Robust LLMs:\n",
    "\n",
    "[{{< bi filetype-pdf >}} Weakly Supervised Detection of Hallucinations in LLMs](https://arxiv.org/pdf/2312.02798)\n",
    ":::\n",
    "\n",
    "::: {.fragment .fade-in-then-semi-out .small}\n",
    "[{{< bi filetype-pdf >}} Localizing Persona Representations In LLMs](https://arxiv.org/pdf/2505.24539)\n",
    ":::\n",
    "\n",
    "::: notes\n",
    "Now we're gonna see what we're put in the prompt, for starters the schema\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "\n",
    "### Getting the schema for the prompt\n",
    "\n",
    "LangChain (ü¶ú ‚õìÔ∏è) community üêç üì¶ provides a simple class that can retrieve some schema information\n",
    "[SQL Question Answering](https://python.langchain.com/docs/tutorials/sql_qa/#system-prompt){target=\"_blank\"}\n",
    "\n",
    "::: {.small}\n",
    "It implements the best practices as specified in: [{{< bi filetype-pdf >}} Rajkumar et al, 2022](https://arxiv.org/abs/2204.00498)\n",
    ":::"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "a4640fbd",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\u001b[2mAudited \u001b[1m1 package\u001b[0m \u001b[2min 38ms\u001b[0m\u001b[0m\r\n"
     ]
    }
   ],
   "source": [
    "#| echo: true\n",
    "!uv pip install langchain-community"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "14fb05cf",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "['frpm', 'satscores', 'schools']"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "#| echo: true\n",
    "\n",
    "from langchain_community.utilities import SQLDatabase\n",
    "db = SQLDatabase(engine=engine)\n",
    "\n",
    "display(db.get_usable_table_names())"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7ec82915",
   "metadata": {},
   "source": [
    "::: notes\n",
    "As we can see, the table names may not be immediately understandable ü§î\n",
    ":::\n",
    "\n",
    "\n",
    "\n",
    "---\n",
    "\n",
    "###"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "9fc02d56",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">\n",
       "CREATE TABLE frpm <span style=\"font-weight: bold\">(</span>\n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"CDSCode\"</span> TEXT NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Academic Year\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"County Code\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"District Code\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"School Code\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"County Name\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"District Name\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"School Name\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"District Type\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"School Type\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Educational Option Type\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"NSLP Provision Status\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Charter School (Y/N)\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Charter School Number\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Charter Funding Type\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"IRC\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Low Grade\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"High Grade\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Enrollment (K-12)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Free Meal Count (K-12)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Percent (%) Eligible Free (K-12)\"</span> \n",
       "REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"FRPM Count (K-12)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Percent (%) Eligible FRPM (K-12)\"</span> \n",
       "REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Enrollment (Ages 5-17)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Free Meal Count (Ages 5-17)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Percent (%) Eligible Free (Ages </span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">5-17)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"FRPM Count (Ages 5-17)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Percent (%) Eligible FRPM (Ages </span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">5-17)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"2013-14 CALPADS Fall 1 Certification</span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">Status\"</span> INTEGER, \n",
       "        PRIMARY KEY <span style=\"font-weight: bold\">(</span><span style=\"color: #008000; text-decoration-color: #008000\">\"CDSCode\"</span><span style=\"font-weight: bold\">)</span>, \n",
       "        FOREIGN <span style=\"color: #800080; text-decoration-color: #800080; font-weight: bold\">KEY</span><span style=\"font-weight: bold\">(</span><span style=\"color: #008000; text-decoration-color: #008000\">\"CDSCode\"</span><span style=\"font-weight: bold\">)</span> REFERENCES \n",
       "schools <span style=\"font-weight: bold\">(</span><span style=\"color: #008000; text-decoration-color: #008000\">\"CDSCode\"</span><span style=\"font-weight: bold\">)</span>\n",
       "<span style=\"font-weight: bold\">)</span>\n",
       "\n",
       "<span style=\"color: #800080; text-decoration-color: #800080\">/</span>*\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span> rows from frpm table:\n",
       "CDSCode Academic Year   County Code     \n",
       "District Code   School Code     County Name  \n",
       "District Name   School Name     District Type\n",
       "School Type     Educational Option Type NSLP \n",
       "Provision Status   Charter School <span style=\"font-weight: bold\">(</span>Y/N<span style=\"font-weight: bold\">)</span>    \n",
       "Charter School Number   Charter Funding Type \n",
       "IRC     Low Grade       High Grade      \n",
       "Enrollment <span style=\"font-weight: bold\">(</span>K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span><span style=\"font-weight: bold\">)</span>       Free Meal Count \n",
       "<span style=\"font-weight: bold\">(</span>K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span><span style=\"font-weight: bold\">)</span>  Percent <span style=\"font-weight: bold\">(</span>%<span style=\"font-weight: bold\">)</span> Eligible Free <span style=\"font-weight: bold\">(</span>K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span><span style=\"font-weight: bold\">)</span>     \n",
       "FRPM Count <span style=\"font-weight: bold\">(</span>K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span><span style=\"font-weight: bold\">)</span>       Percent <span style=\"font-weight: bold\">(</span>%<span style=\"font-weight: bold\">)</span> Eligible \n",
       "FRPM <span style=\"font-weight: bold\">(</span>K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span><span style=\"font-weight: bold\">)</span>        Enrollment <span style=\"font-weight: bold\">(</span>Ages <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17</span><span style=\"font-weight: bold\">)</span>  \n",
       "Free Meal Count <span style=\"font-weight: bold\">(</span>Ages <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17</span><span style=\"font-weight: bold\">)</span>     Percent <span style=\"font-weight: bold\">(</span>%<span style=\"font-weight: bold\">)</span> \n",
       "Eligible Free <span style=\"font-weight: bold\">(</span>Ages <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17</span><span style=\"font-weight: bold\">)</span>   FRPM Count <span style=\"font-weight: bold\">(</span>Ages \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17</span><span style=\"font-weight: bold\">)</span>  Percent <span style=\"font-weight: bold\">(</span>%<span style=\"font-weight: bold\">)</span> Eligible FRPM <span style=\"font-weight: bold\">(</span>Ages <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17</span><span style=\"font-weight: bold\">)</span> \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2013</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">14</span> CALPADS Fall <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> Certification Status\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170109835</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2014</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2015</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10017</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0109835</span> Alameda Alameda County Office of \n",
       "Education      FAME Public Charter     County\n",
       "Office of Education <span style=\"font-weight: bold\">(</span>COE<span style=\"font-weight: bold\">)</span>        K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span> Schools\n",
       "<span style=\"font-weight: bold\">(</span>Public<span style=\"font-weight: bold\">)</span>   Traditional     <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0728</span>    Directly funded <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       K       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1087.0</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">565.0</span>   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.519779208831647</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">715.0</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.657773689052438</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1070.0</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">553.0</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.516822429906542</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">702.0</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.65607476635514</span>        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170112607</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2014</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2015</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10017</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0112607</span> Alameda Alameda County Office of \n",
       "Education      Envision Academy for Arts &amp; \n",
       "Technology  County Office of Education <span style=\"font-weight: bold\">(</span>COE<span style=\"font-weight: bold\">)</span> \n",
       "High Schools <span style=\"font-weight: bold\">(</span>Public<span style=\"font-weight: bold\">)</span>   Traditional     <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span> \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0811</span>    Directly funded <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span>    \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">395.0</span>   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">186.0</span>   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.470886075949367</span>    \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">186.0</span>   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.470886075949367</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">376.0</span>   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">182.0</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.484042553191489</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">182.0</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.484042553191489</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170118489</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2014</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2015</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10017</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0118489</span> Alameda Alameda County Office of \n",
       "Education      Aspire California College \n",
       "Preparatory Academy   County Office of \n",
       "Education <span style=\"font-weight: bold\">(</span>COE<span style=\"font-weight: bold\">)</span>        High Schools <span style=\"font-weight: bold\">(</span>Public<span style=\"font-weight: bold\">)</span> \n",
       "Traditional     <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1049</span>    \n",
       "Directly funded <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">244.0</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">134.0</span>   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.549180327868853</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">175.0</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.717213114754098</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">230.0</span>   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">128.0</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.556521739130435</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">168.0</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.730434782608696</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>\n",
       "*<span style=\"color: #800080; text-decoration-color: #800080\">/</span>\n",
       "\n",
       "\n",
       "CREATE TABLE satscores <span style=\"font-weight: bold\">(</span>\n",
       "        cds TEXT NOT NULL, \n",
       "        rtype TEXT NOT NULL, \n",
       "        sname TEXT, \n",
       "        dname TEXT, \n",
       "        cname TEXT, \n",
       "        enroll12 INTEGER NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"NumTstTakr\"</span> INTEGER NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AvgScrRead\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AvgScrMath\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AvgScrWrite\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"NumGE1500\"</span> INTEGER, \n",
       "        PRIMARY KEY <span style=\"font-weight: bold\">(</span>cds<span style=\"font-weight: bold\">)</span>, \n",
       "        FOREIGN <span style=\"color: #800080; text-decoration-color: #800080; font-weight: bold\">KEY</span><span style=\"font-weight: bold\">(</span>cds<span style=\"font-weight: bold\">)</span> REFERENCES schools \n",
       "<span style=\"font-weight: bold\">(</span><span style=\"color: #008000; text-decoration-color: #008000\">\"CDSCode\"</span><span style=\"font-weight: bold\">)</span>\n",
       "<span style=\"font-weight: bold\">)</span>\n",
       "\n",
       "<span style=\"color: #800080; text-decoration-color: #800080\">/</span>*\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span> rows from satscores table:\n",
       "cds     rtype   sname   dname   cname   \n",
       "enroll12        NumTstTakr      AvgScrRead   \n",
       "AvgScrMath      AvgScrWrite     NumGE1500\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170000000</span>  D       <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    Alameda \n",
       "County Office of Education      Alameda <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">398</span>  \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">88</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">418</span>     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">418</span>     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">417</span>     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">14</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170109835</span>  S       FAME Public Charter  \n",
       "Alameda County Office of Education      \n",
       "Alameda <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">62</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">503</span>     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">546</span>     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">505</span>  \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170112607</span>  S       Envision Academy for \n",
       "Arts &amp; Technology  Alameda County Office of \n",
       "Education      Alameda <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">75</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">71</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">397</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">387</span>     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">395</span>     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span>\n",
       "*<span style=\"color: #800080; text-decoration-color: #800080\">/</span>\n",
       "\n",
       "\n",
       "CREATE TABLE schools <span style=\"font-weight: bold\">(</span>\n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"CDSCode\"</span> TEXT NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"NCESDist\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"NCESSchool\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"StatusType\"</span> TEXT NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"County\"</span> TEXT NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"District\"</span> TEXT NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"School\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Street\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"StreetAbr\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"City\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Zip\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"State\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"MailStreet\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"MailStrAbr\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"MailCity\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"MailZip\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"MailState\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Phone\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Ext\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Website\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"OpenDate\"</span> DATE, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"ClosedDate\"</span> DATE, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Charter\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"CharterNum\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"FundingType\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"DOC\"</span> TEXT NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"DOCType\"</span> TEXT NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"SOC\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"SOCType\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"EdOpsCode\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"EdOpsName\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"EILCode\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"EILName\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"GSoffered\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"GSserved\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Virtual\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Magnet\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Latitude\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Longitude\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmFName1\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmLName1\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmEmail1\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmFName2\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmLName2\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmEmail2\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmFName3\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmLName3\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmEmail3\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"LastUpdate\"</span> DATE NOT NULL, \n",
       "        PRIMARY KEY <span style=\"font-weight: bold\">(</span><span style=\"color: #008000; text-decoration-color: #008000\">\"CDSCode\"</span><span style=\"font-weight: bold\">)</span>\n",
       "<span style=\"font-weight: bold\">)</span>\n",
       "\n",
       "<span style=\"color: #800080; text-decoration-color: #800080\">/</span>*\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span> rows from schools table:\n",
       "CDSCode NCESDist        NCESSchool      \n",
       "StatusType      County  District        \n",
       "School  Street  StreetAbr       City    Zip  \n",
       "State   MailStreet      MailStrAbr      \n",
       "MailCity        MailZip MailState       Phone\n",
       "Ext     Website OpenDate        ClosedDate   \n",
       "Charter CharterNum      FundingType     DOC  \n",
       "DOCType SOC     SOCType EdOpsCode       \n",
       "EdOpsName       EILCode EILName GSoffered    \n",
       "GSserved        Virtual Magnet  Latitude     \n",
       "Longitude       AdmFName1       AdmLName1    \n",
       "AdmEmail1       AdmFName2       AdmLName2    \n",
       "AdmEmail2       AdmFName3       AdmLName3    \n",
       "AdmEmail3       LastUpdate\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170000000</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0691051</span> <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    Active  \n",
       "Alameda Alameda County Office of Education   \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">313</span> West Winton Avenue  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">313</span> West \n",
       "Winton Ave.    Hayward <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">94544</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1136</span>      CA    \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">313</span> West Winton Avenue  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">313</span> West Winton Ave. \n",
       "Hayward <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">94544</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1136</span>      CA      <span style=\"font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">510</span><span style=\"font-weight: bold\">)</span> \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">887</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0152</span>  <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    www.acoe.org    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">00</span>      \n",
       "County Office of Education <span style=\"font-weight: bold\">(</span>COE<span style=\"font-weight: bold\">)</span>        <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span> \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span> \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">37.658212</span>       \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-122.09713</span>      L Karen Monroe  \n",
       "lkmonroe@acoe.org       <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span> \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2015</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">06</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">23</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170109835</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0691051</span> <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10546</span>   Closed  \n",
       "Alameda Alameda County Office of Education   \n",
       "FAME Public Charter     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39899</span> Balentine \n",
       "Drive, Suite <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">335</span>        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39899</span> Balentine Dr., \n",
       "Ste. <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">335</span>   Newark  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">94560</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5359</span>      CA      \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39899</span> Balentine Drive, Suite <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">335</span>        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39899</span>\n",
       "Balentine Dr., Ste. <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">335</span>   Newark  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">94560</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5359</span> \n",
       "CA      <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2005</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">08</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">29</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2015</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">07</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">31</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0728</span>    Directly \n",
       "funded <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">00</span>      County Office of Education \n",
       "<span style=\"font-weight: bold\">(</span>COE<span style=\"font-weight: bold\">)</span>        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">65</span>      K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span> Schools <span style=\"font-weight: bold\">(</span>Public<span style=\"font-weight: bold\">)</span>   \n",
       "TRAD    Traditional     ELEMHIGH        \n",
       "Elementary-High Combination     K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span>    K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span> \n",
       "P       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">37.521436</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-121.99391</span>   \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span> \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2015</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">09</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170112607</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0691051</span> <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10947</span>   Active  \n",
       "Alameda Alameda County Office of Education   \n",
       "Envision Academy for Arts &amp; Technology  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1515</span> \n",
       "Webster Street     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1515</span> Webster St.        \n",
       "Oakland <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">94612</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3355</span>      CA      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1515</span> Webster \n",
       "Street     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1515</span> Webster St.        Oakland \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">94612</span>   CA      <span style=\"font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">510</span><span style=\"font-weight: bold\">)</span> <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">596</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8901</span>  <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    \n",
       "www.envisionacademy.org/        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2006</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">08</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">28</span>   \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0811</span>    Directly funded <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">00</span>   \n",
       "County Office of Education <span style=\"font-weight: bold\">(</span>COE<span style=\"font-weight: bold\">)</span>        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">66</span>   \n",
       "High Schools <span style=\"font-weight: bold\">(</span>Public<span style=\"font-weight: bold\">)</span>   TRAD    Traditional  \n",
       "HS      High School     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span>    N    \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">37.80452</span>        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-122.26815</span>      Laura\n",
       "Robell  laura@envisionacademy.org       <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span> \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2015</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">06</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">18</span>\n",
       "*<span style=\"color: #800080; text-decoration-color: #800080\">/</span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\n",
       "CREATE TABLE frpm \u001b[1m(\u001b[0m\n",
       "        \u001b[32m\"CDSCode\"\u001b[0m TEXT NOT NULL, \n",
       "        \u001b[32m\"Academic Year\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"County Code\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"District Code\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"School Code\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"County Name\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"District Name\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"School Name\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"District Type\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"School Type\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Educational Option Type\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"NSLP Provision Status\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Charter School \u001b[0m\u001b[32m(\u001b[0m\u001b[32mY/N\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"Charter School Number\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Charter Funding Type\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"IRC\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"Low Grade\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"High Grade\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Enrollment \u001b[0m\u001b[32m(\u001b[0m\u001b[32mK-12\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"Free Meal Count \u001b[0m\u001b[32m(\u001b[0m\u001b[32mK-12\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"Percent \u001b[0m\u001b[32m(\u001b[0m\u001b[32m%\u001b[0m\u001b[32m)\u001b[0m\u001b[32m Eligible Free \u001b[0m\u001b[32m(\u001b[0m\u001b[32mK-12\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m \n",
       "REAL, \n",
       "        \u001b[32m\"FRPM Count \u001b[0m\u001b[32m(\u001b[0m\u001b[32mK-12\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"Percent \u001b[0m\u001b[32m(\u001b[0m\u001b[32m%\u001b[0m\u001b[32m)\u001b[0m\u001b[32m Eligible FRPM \u001b[0m\u001b[32m(\u001b[0m\u001b[32mK-12\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m \n",
       "REAL, \n",
       "        \u001b[32m\"Enrollment \u001b[0m\u001b[32m(\u001b[0m\u001b[32mAges 5-17\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"Free Meal Count \u001b[0m\u001b[32m(\u001b[0m\u001b[32mAges 5-17\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"Percent \u001b[0m\u001b[32m(\u001b[0m\u001b[32m%\u001b[0m\u001b[32m)\u001b[0m\u001b[32m Eligible Free \u001b[0m\u001b[32m(\u001b[0m\u001b[32mAges \u001b[0m\n",
       "\u001b[32m5-17\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"FRPM Count \u001b[0m\u001b[32m(\u001b[0m\u001b[32mAges 5-17\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"Percent \u001b[0m\u001b[32m(\u001b[0m\u001b[32m%\u001b[0m\u001b[32m)\u001b[0m\u001b[32m Eligible FRPM \u001b[0m\u001b[32m(\u001b[0m\u001b[32mAges \u001b[0m\n",
       "\u001b[32m5-17\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"2013-14 CALPADS Fall 1 Certification\u001b[0m\n",
       "\u001b[32mStatus\"\u001b[0m INTEGER, \n",
       "        PRIMARY KEY \u001b[1m(\u001b[0m\u001b[32m\"CDSCode\"\u001b[0m\u001b[1m)\u001b[0m, \n",
       "        FOREIGN \u001b[1;35mKEY\u001b[0m\u001b[1m(\u001b[0m\u001b[32m\"CDSCode\"\u001b[0m\u001b[1m)\u001b[0m REFERENCES \n",
       "schools \u001b[1m(\u001b[0m\u001b[32m\"CDSCode\"\u001b[0m\u001b[1m)\u001b[0m\n",
       "\u001b[1m)\u001b[0m\n",
       "\n",
       "\u001b[35m/\u001b[0m*\n",
       "\u001b[1;36m3\u001b[0m rows from frpm table:\n",
       "CDSCode Academic Year   County Code     \n",
       "District Code   School Code     County Name  \n",
       "District Name   School Name     District Type\n",
       "School Type     Educational Option Type NSLP \n",
       "Provision Status   Charter School \u001b[1m(\u001b[0mY/N\u001b[1m)\u001b[0m    \n",
       "Charter School Number   Charter Funding Type \n",
       "IRC     Low Grade       High Grade      \n",
       "Enrollment \u001b[1m(\u001b[0mK-\u001b[1;36m12\u001b[0m\u001b[1m)\u001b[0m       Free Meal Count \n",
       "\u001b[1m(\u001b[0mK-\u001b[1;36m12\u001b[0m\u001b[1m)\u001b[0m  Percent \u001b[1m(\u001b[0m%\u001b[1m)\u001b[0m Eligible Free \u001b[1m(\u001b[0mK-\u001b[1;36m12\u001b[0m\u001b[1m)\u001b[0m     \n",
       "FRPM Count \u001b[1m(\u001b[0mK-\u001b[1;36m12\u001b[0m\u001b[1m)\u001b[0m       Percent \u001b[1m(\u001b[0m%\u001b[1m)\u001b[0m Eligible \n",
       "FRPM \u001b[1m(\u001b[0mK-\u001b[1;36m12\u001b[0m\u001b[1m)\u001b[0m        Enrollment \u001b[1m(\u001b[0mAges \u001b[1;36m5\u001b[0m-\u001b[1;36m17\u001b[0m\u001b[1m)\u001b[0m  \n",
       "Free Meal Count \u001b[1m(\u001b[0mAges \u001b[1;36m5\u001b[0m-\u001b[1;36m17\u001b[0m\u001b[1m)\u001b[0m     Percent \u001b[1m(\u001b[0m%\u001b[1m)\u001b[0m \n",
       "Eligible Free \u001b[1m(\u001b[0mAges \u001b[1;36m5\u001b[0m-\u001b[1;36m17\u001b[0m\u001b[1m)\u001b[0m   FRPM Count \u001b[1m(\u001b[0mAges \n",
       "\u001b[1;36m5\u001b[0m-\u001b[1;36m17\u001b[0m\u001b[1m)\u001b[0m  Percent \u001b[1m(\u001b[0m%\u001b[1m)\u001b[0m Eligible FRPM \u001b[1m(\u001b[0mAges \u001b[1;36m5\u001b[0m-\u001b[1;36m17\u001b[0m\u001b[1m)\u001b[0m \n",
       "\u001b[1;36m2013\u001b[0m-\u001b[1;36m14\u001b[0m CALPADS Fall \u001b[1;36m1\u001b[0m Certification Status\n",
       "\u001b[1;36m01100170109835\u001b[0m  \u001b[1;36m2014\u001b[0m-\u001b[1;36m2015\u001b[0m       \u001b[1;36m01\u001b[0m      \u001b[1;36m10017\u001b[0m\n",
       "\u001b[1;36m0109835\u001b[0m Alameda Alameda County Office of \n",
       "Education      FAME Public Charter     County\n",
       "Office of Education \u001b[1m(\u001b[0mCOE\u001b[1m)\u001b[0m        K-\u001b[1;36m12\u001b[0m Schools\n",
       "\u001b[1m(\u001b[0mPublic\u001b[1m)\u001b[0m   Traditional     \u001b[3;35mNone\u001b[0m    \u001b[1;36m1\u001b[0m       \n",
       "\u001b[1;36m0728\u001b[0m    Directly funded \u001b[1;36m1\u001b[0m       K       \u001b[1;36m12\u001b[0m   \n",
       "\u001b[1;36m1087.0\u001b[0m  \u001b[1;36m565.0\u001b[0m   \u001b[1;36m0.519779208831647\u001b[0m       \u001b[1;36m715.0\u001b[0m\n",
       "\u001b[1;36m0.657773689052438\u001b[0m       \u001b[1;36m1070.0\u001b[0m  \u001b[1;36m553.0\u001b[0m   \n",
       "\u001b[1;36m0.516822429906542\u001b[0m       \u001b[1;36m702.0\u001b[0m   \n",
       "\u001b[1;36m0.65607476635514\u001b[0m        \u001b[1;36m1\u001b[0m\n",
       "\u001b[1;36m01100170112607\u001b[0m  \u001b[1;36m2014\u001b[0m-\u001b[1;36m2015\u001b[0m       \u001b[1;36m01\u001b[0m      \u001b[1;36m10017\u001b[0m\n",
       "\u001b[1;36m0112607\u001b[0m Alameda Alameda County Office of \n",
       "Education      Envision Academy for Arts & \n",
       "Technology  County Office of Education \u001b[1m(\u001b[0mCOE\u001b[1m)\u001b[0m \n",
       "High Schools \u001b[1m(\u001b[0mPublic\u001b[1m)\u001b[0m   Traditional     \u001b[3;35mNone\u001b[0m \n",
       "\u001b[1;36m1\u001b[0m       \u001b[1;36m0811\u001b[0m    Directly funded \u001b[1;36m1\u001b[0m       \u001b[1;36m9\u001b[0m    \n",
       "\u001b[1;36m12\u001b[0m      \u001b[1;36m395.0\u001b[0m   \u001b[1;36m186.0\u001b[0m   \u001b[1;36m0.470886075949367\u001b[0m    \n",
       "\u001b[1;36m186.0\u001b[0m   \u001b[1;36m0.470886075949367\u001b[0m       \u001b[1;36m376.0\u001b[0m   \u001b[1;36m182.0\u001b[0m\n",
       "\u001b[1;36m0.484042553191489\u001b[0m       \u001b[1;36m182.0\u001b[0m   \n",
       "\u001b[1;36m0.484042553191489\u001b[0m       \u001b[1;36m1\u001b[0m\n",
       "\u001b[1;36m01100170118489\u001b[0m  \u001b[1;36m2014\u001b[0m-\u001b[1;36m2015\u001b[0m       \u001b[1;36m01\u001b[0m      \u001b[1;36m10017\u001b[0m\n",
       "\u001b[1;36m0118489\u001b[0m Alameda Alameda County Office of \n",
       "Education      Aspire California College \n",
       "Preparatory Academy   County Office of \n",
       "Education \u001b[1m(\u001b[0mCOE\u001b[1m)\u001b[0m        High Schools \u001b[1m(\u001b[0mPublic\u001b[1m)\u001b[0m \n",
       "Traditional     \u001b[3;35mNone\u001b[0m    \u001b[1;36m1\u001b[0m       \u001b[1;36m1049\u001b[0m    \n",
       "Directly funded \u001b[1;36m1\u001b[0m       \u001b[1;36m9\u001b[0m       \u001b[1;36m12\u001b[0m      \u001b[1;36m244.0\u001b[0m\n",
       "\u001b[1;36m134.0\u001b[0m   \u001b[1;36m0.549180327868853\u001b[0m       \u001b[1;36m175.0\u001b[0m   \n",
       "\u001b[1;36m0.717213114754098\u001b[0m       \u001b[1;36m230.0\u001b[0m   \u001b[1;36m128.0\u001b[0m   \n",
       "\u001b[1;36m0.556521739130435\u001b[0m       \u001b[1;36m168.0\u001b[0m   \n",
       "\u001b[1;36m0.730434782608696\u001b[0m       \u001b[1;36m1\u001b[0m\n",
       "*\u001b[35m/\u001b[0m\n",
       "\n",
       "\n",
       "CREATE TABLE satscores \u001b[1m(\u001b[0m\n",
       "        cds TEXT NOT NULL, \n",
       "        rtype TEXT NOT NULL, \n",
       "        sname TEXT, \n",
       "        dname TEXT, \n",
       "        cname TEXT, \n",
       "        enroll12 INTEGER NOT NULL, \n",
       "        \u001b[32m\"NumTstTakr\"\u001b[0m INTEGER NOT NULL, \n",
       "        \u001b[32m\"AvgScrRead\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"AvgScrMath\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"AvgScrWrite\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"NumGE1500\"\u001b[0m INTEGER, \n",
       "        PRIMARY KEY \u001b[1m(\u001b[0mcds\u001b[1m)\u001b[0m, \n",
       "        FOREIGN \u001b[1;35mKEY\u001b[0m\u001b[1m(\u001b[0mcds\u001b[1m)\u001b[0m REFERENCES schools \n",
       "\u001b[1m(\u001b[0m\u001b[32m\"CDSCode\"\u001b[0m\u001b[1m)\u001b[0m\n",
       "\u001b[1m)\u001b[0m\n",
       "\n",
       "\u001b[35m/\u001b[0m*\n",
       "\u001b[1;36m3\u001b[0m rows from satscores table:\n",
       "cds     rtype   sname   dname   cname   \n",
       "enroll12        NumTstTakr      AvgScrRead   \n",
       "AvgScrMath      AvgScrWrite     NumGE1500\n",
       "\u001b[1;36m01100170000000\u001b[0m  D       \u001b[3;35mNone\u001b[0m    Alameda \n",
       "County Office of Education      Alameda \u001b[1;36m398\u001b[0m  \n",
       "\u001b[1;36m88\u001b[0m      \u001b[1;36m418\u001b[0m     \u001b[1;36m418\u001b[0m     \u001b[1;36m417\u001b[0m     \u001b[1;36m14\u001b[0m\n",
       "\u001b[1;36m01100170109835\u001b[0m  S       FAME Public Charter  \n",
       "Alameda County Office of Education      \n",
       "Alameda \u001b[1;36m62\u001b[0m      \u001b[1;36m17\u001b[0m      \u001b[1;36m503\u001b[0m     \u001b[1;36m546\u001b[0m     \u001b[1;36m505\u001b[0m  \n",
       "\u001b[1;36m9\u001b[0m\n",
       "\u001b[1;36m01100170112607\u001b[0m  S       Envision Academy for \n",
       "Arts & Technology  Alameda County Office of \n",
       "Education      Alameda \u001b[1;36m75\u001b[0m      \u001b[1;36m71\u001b[0m      \u001b[1;36m397\u001b[0m   \n",
       "\u001b[1;36m387\u001b[0m     \u001b[1;36m395\u001b[0m     \u001b[1;36m5\u001b[0m\n",
       "*\u001b[35m/\u001b[0m\n",
       "\n",
       "\n",
       "CREATE TABLE schools \u001b[1m(\u001b[0m\n",
       "        \u001b[32m\"CDSCode\"\u001b[0m TEXT NOT NULL, \n",
       "        \u001b[32m\"NCESDist\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"NCESSchool\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"StatusType\"\u001b[0m TEXT NOT NULL, \n",
       "        \u001b[32m\"County\"\u001b[0m TEXT NOT NULL, \n",
       "        \u001b[32m\"District\"\u001b[0m TEXT NOT NULL, \n",
       "        \u001b[32m\"School\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Street\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"StreetAbr\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"City\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Zip\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"State\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"MailStreet\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"MailStrAbr\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"MailCity\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"MailZip\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"MailState\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Phone\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Ext\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Website\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"OpenDate\"\u001b[0m DATE, \n",
       "        \u001b[32m\"ClosedDate\"\u001b[0m DATE, \n",
       "        \u001b[32m\"Charter\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"CharterNum\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"FundingType\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"DOC\"\u001b[0m TEXT NOT NULL, \n",
       "        \u001b[32m\"DOCType\"\u001b[0m TEXT NOT NULL, \n",
       "        \u001b[32m\"SOC\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"SOCType\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"EdOpsCode\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"EdOpsName\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"EILCode\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"EILName\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"GSoffered\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"GSserved\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Virtual\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Magnet\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"Latitude\"\u001b[0m REAL, \n",
       "        \u001b[32m\"Longitude\"\u001b[0m REAL, \n",
       "        \u001b[32m\"AdmFName1\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmLName1\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmEmail1\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmFName2\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmLName2\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmEmail2\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmFName3\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmLName3\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmEmail3\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"LastUpdate\"\u001b[0m DATE NOT NULL, \n",
       "        PRIMARY KEY \u001b[1m(\u001b[0m\u001b[32m\"CDSCode\"\u001b[0m\u001b[1m)\u001b[0m\n",
       "\u001b[1m)\u001b[0m\n",
       "\n",
       "\u001b[35m/\u001b[0m*\n",
       "\u001b[1;36m3\u001b[0m rows from schools table:\n",
       "CDSCode NCESDist        NCESSchool      \n",
       "StatusType      County  District        \n",
       "School  Street  StreetAbr       City    Zip  \n",
       "State   MailStreet      MailStrAbr      \n",
       "MailCity        MailZip MailState       Phone\n",
       "Ext     Website OpenDate        ClosedDate   \n",
       "Charter CharterNum      FundingType     DOC  \n",
       "DOCType SOC     SOCType EdOpsCode       \n",
       "EdOpsName       EILCode EILName GSoffered    \n",
       "GSserved        Virtual Magnet  Latitude     \n",
       "Longitude       AdmFName1       AdmLName1    \n",
       "AdmEmail1       AdmFName2       AdmLName2    \n",
       "AdmEmail2       AdmFName3       AdmLName3    \n",
       "AdmEmail3       LastUpdate\n",
       "\u001b[1;36m01100170000000\u001b[0m  \u001b[1;36m0691051\u001b[0m \u001b[3;35mNone\u001b[0m    Active  \n",
       "Alameda Alameda County Office of Education   \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[1;36m313\u001b[0m West Winton Avenue  \u001b[1;36m313\u001b[0m West \n",
       "Winton Ave.    Hayward \u001b[1;36m94544\u001b[0m-\u001b[1;36m1136\u001b[0m      CA    \n",
       "\u001b[1;36m313\u001b[0m West Winton Avenue  \u001b[1;36m313\u001b[0m West Winton Ave. \n",
       "Hayward \u001b[1;36m94544\u001b[0m-\u001b[1;36m1136\u001b[0m      CA      \u001b[1m(\u001b[0m\u001b[1;36m510\u001b[0m\u001b[1m)\u001b[0m \n",
       "\u001b[1;36m887\u001b[0m-\u001b[1;36m0152\u001b[0m  \u001b[3;35mNone\u001b[0m    www.acoe.org    \u001b[3;35mNone\u001b[0m    \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[1;36m00\u001b[0m      \n",
       "County Office of Education \u001b[1m(\u001b[0mCOE\u001b[1m)\u001b[0m        \u001b[3;35mNone\u001b[0m \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[1;36m37.658212\u001b[0m       \n",
       "\u001b[1;36m-122.09713\u001b[0m      L Karen Monroe  \n",
       "lkmonroe@acoe.org       \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[1;36m2015\u001b[0m-\u001b[1;36m06\u001b[0m-\u001b[1;36m23\u001b[0m\n",
       "\u001b[1;36m01100170109835\u001b[0m  \u001b[1;36m0691051\u001b[0m \u001b[1;36m10546\u001b[0m   Closed  \n",
       "Alameda Alameda County Office of Education   \n",
       "FAME Public Charter     \u001b[1;36m39899\u001b[0m Balentine \n",
       "Drive, Suite \u001b[1;36m335\u001b[0m        \u001b[1;36m39899\u001b[0m Balentine Dr., \n",
       "Ste. \u001b[1;36m335\u001b[0m   Newark  \u001b[1;36m94560\u001b[0m-\u001b[1;36m5359\u001b[0m      CA      \n",
       "\u001b[1;36m39899\u001b[0m Balentine Drive, Suite \u001b[1;36m335\u001b[0m        \u001b[1;36m39899\u001b[0m\n",
       "Balentine Dr., Ste. \u001b[1;36m335\u001b[0m   Newark  \u001b[1;36m94560\u001b[0m-\u001b[1;36m5359\u001b[0m \n",
       "CA      \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[1;36m2005\u001b[0m-\u001b[1;36m08\u001b[0m-\u001b[1;36m29\u001b[0m   \n",
       "\u001b[1;36m2015\u001b[0m-\u001b[1;36m07\u001b[0m-\u001b[1;36m31\u001b[0m      \u001b[1;36m1\u001b[0m       \u001b[1;36m0728\u001b[0m    Directly \n",
       "funded \u001b[1;36m00\u001b[0m      County Office of Education \n",
       "\u001b[1m(\u001b[0mCOE\u001b[1m)\u001b[0m        \u001b[1;36m65\u001b[0m      K-\u001b[1;36m12\u001b[0m Schools \u001b[1m(\u001b[0mPublic\u001b[1m)\u001b[0m   \n",
       "TRAD    Traditional     ELEMHIGH        \n",
       "Elementary-High Combination     K-\u001b[1;36m12\u001b[0m    K-\u001b[1;36m12\u001b[0m \n",
       "P       \u001b[1;36m0\u001b[0m       \u001b[1;36m37.521436\u001b[0m       \u001b[1;36m-121.99391\u001b[0m   \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[1;36m2015\u001b[0m-\u001b[1;36m09\u001b[0m-\u001b[1;36m01\u001b[0m\n",
       "\u001b[1;36m01100170112607\u001b[0m  \u001b[1;36m0691051\u001b[0m \u001b[1;36m10947\u001b[0m   Active  \n",
       "Alameda Alameda County Office of Education   \n",
       "Envision Academy for Arts & Technology  \u001b[1;36m1515\u001b[0m \n",
       "Webster Street     \u001b[1;36m1515\u001b[0m Webster St.        \n",
       "Oakland \u001b[1;36m94612\u001b[0m-\u001b[1;36m3355\u001b[0m      CA      \u001b[1;36m1515\u001b[0m Webster \n",
       "Street     \u001b[1;36m1515\u001b[0m Webster St.        Oakland \n",
       "\u001b[1;36m94612\u001b[0m   CA      \u001b[1m(\u001b[0m\u001b[1;36m510\u001b[0m\u001b[1m)\u001b[0m \u001b[1;36m596\u001b[0m-\u001b[1;36m8901\u001b[0m  \u001b[3;35mNone\u001b[0m    \n",
       "www.envisionacademy.org/        \u001b[1;36m2006\u001b[0m-\u001b[1;36m08\u001b[0m-\u001b[1;36m28\u001b[0m   \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[1;36m1\u001b[0m       \u001b[1;36m0811\u001b[0m    Directly funded \u001b[1;36m00\u001b[0m   \n",
       "County Office of Education \u001b[1m(\u001b[0mCOE\u001b[1m)\u001b[0m        \u001b[1;36m66\u001b[0m   \n",
       "High Schools \u001b[1m(\u001b[0mPublic\u001b[1m)\u001b[0m   TRAD    Traditional  \n",
       "HS      High School     \u001b[1;36m9\u001b[0m-\u001b[1;36m12\u001b[0m    \u001b[1;36m9\u001b[0m-\u001b[1;36m12\u001b[0m    N    \n",
       "\u001b[1;36m0\u001b[0m       \u001b[1;36m37.80452\u001b[0m        \u001b[1;36m-122.26815\u001b[0m      Laura\n",
       "Robell  laura@envisionacademy.org       \u001b[3;35mNone\u001b[0m \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \n",
       "\u001b[1;36m2015\u001b[0m-\u001b[1;36m06\u001b[0m-\u001b[1;36m18\u001b[0m\n",
       "*\u001b[35m/\u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "#| echo: true\n",
    "#| code-overflow: wrap\n",
    "#| \n",
    "print(db.get_table_info())\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3e0bb115",
   "metadata": {},
   "source": [
    "<!-- Disable footer -->\n",
    "::: footer\n",
    ":::\n",
    "\n",
    "\n",
    "---\n",
    "\n",
    "### Prompts {.smaller}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "d0dbbdf4",
   "metadata": {},
   "outputs": [],
   "source": [
    "#| echo: true\n",
    "#| code-line-numbers: 1-7|8-14|15-18\n",
    "\n",
    "system_message = \"\"\"\n",
    "Given an input question, create a syntactically correct {dialect} query to\n",
    "run to help find the answer. Unless the user specifies in his question a\n",
    "specific number of examples they wish to obtain, always limit your query to\n",
    "at most {top_k} results. You can order the results by a relevant column to\n",
    "return the most interesting examples in the database.\n",
    "\n",
    "Never query for all the columns from a specific table, only ask for a the\n",
    "few relevant columns given the question.\n",
    "\n",
    "Pay attention to use only the column names that you can see in the schema\n",
    "description. Be careful to not query for columns that do not exist. Also,\n",
    "pay attention to which column is in which table.\n",
    "\n",
    "Only use the following tables:\n",
    "{table_info}\n",
    "\"\"\""
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a3a9145c",
   "metadata": {},
   "source": [
    "::: {.small_text}\n",
    "\n",
    "[source {{< bi box-arrow-up-right >}}](https://python.langchain.com/docs/tutorials/sql_qa/#convert-question-to-sql-query)\n",
    "\n",
    ":::\n",
    "\n",
    "--- \n",
    "\n",
    "## The messages that constitute the prompt {.smaller}\n",
    "\n",
    "Now we construct a list of messages. These are `dicts` which have a key\n",
    "`user` or `system`, and a `content`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "780b6897",
   "metadata": {
    "output-location": "slide"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[{'role': 'system',\n",
       "  'content': '\\nGiven an input question, create a syntactically correct sqlite query to\\nrun to help find the answer. Unless the user specifies in his question a\\nspecific number of examples they wish to obtain, always limit your query to\\nat most 10 results. You can order the results by a relevant column to\\nreturn the most interesting examples in the database.\\n\\nNever query for all the columns from a specific table, only ask for a the\\nfew relevant columns given the question.\\n\\nPay attention to use only the column names that you can see in the schema\\ndescription. Be careful to not query for columns that do not exist. Also,\\npay attention to which column is in which table.\\n\\nOnly use the following tables:\\n\\nCREATE TABLE frpm (\\n\\t\"CDSCode\" TEXT NOT NULL, \\n\\t\"Academic Year\" TEXT, \\n\\t\"County Code\" TEXT, \\n\\t\"District Code\" INTEGER, \\n\\t\"School Code\" TEXT, \\n\\t\"County Name\" TEXT, \\n\\t\"District Name\" TEXT, \\n\\t\"School Name\" TEXT, \\n\\t\"District Type\" TEXT, \\n\\t\"School Type\" TEXT, \\n\\t\"Educational Option Type\" TEXT, \\n\\t\"NSLP Provision Status\" TEXT, \\n\\t\"Charter School (Y/N)\" INTEGER, \\n\\t\"Charter School Number\" TEXT, \\n\\t\"Charter Funding Type\" TEXT, \\n\\t\"IRC\" INTEGER, \\n\\t\"Low Grade\" TEXT, \\n\\t\"High Grade\" TEXT, \\n\\t\"Enrollment (K-12)\" REAL, \\n\\t\"Free Meal Count (K-12)\" REAL, \\n\\t\"Percent (%) Eligible Free (K-12)\" REAL, \\n\\t\"FRPM Count (K-12)\" REAL, \\n\\t\"Percent (%) Eligible FRPM (K-12)\" REAL, \\n\\t\"Enrollment (Ages 5-17)\" REAL, \\n\\t\"Free Meal Count (Ages 5-17)\" REAL, \\n\\t\"Percent (%) Eligible Free (Ages 5-17)\" REAL, \\n\\t\"FRPM Count (Ages 5-17)\" REAL, \\n\\t\"Percent (%) Eligible FRPM (Ages 5-17)\" REAL, \\n\\t\"2013-14 CALPADS Fall 1 Certification Status\" INTEGER, \\n\\tPRIMARY KEY (\"CDSCode\"), \\n\\tFOREIGN KEY(\"CDSCode\") REFERENCES schools (\"CDSCode\")\\n)\\n\\n/*\\n3 rows from frpm table:\\nCDSCode\\tAcademic Year\\tCounty Code\\tDistrict Code\\tSchool Code\\tCounty Name\\tDistrict Name\\tSchool Name\\tDistrict Type\\tSchool Type\\tEducational Option Type\\tNSLP Provision Status\\tCharter School (Y/N)\\tCharter School Number\\tCharter Funding Type\\tIRC\\tLow Grade\\tHigh Grade\\tEnrollment (K-12)\\tFree Meal Count (K-12)\\tPercent (%) Eligible Free (K-12)\\tFRPM Count (K-12)\\tPercent (%) Eligible FRPM (K-12)\\tEnrollment (Ages 5-17)\\tFree Meal Count (Ages 5-17)\\tPercent (%) Eligible Free (Ages 5-17)\\tFRPM Count (Ages 5-17)\\tPercent (%) Eligible FRPM (Ages 5-17)\\t2013-14 CALPADS Fall 1 Certification Status\\n01100170109835\\t2014-2015\\t01\\t10017\\t0109835\\tAlameda\\tAlameda County Office of Education\\tFAME Public Charter\\tCounty Office of Education (COE)\\tK-12 Schools (Public)\\tTraditional\\tNone\\t1\\t0728\\tDirectly funded\\t1\\tK\\t12\\t1087.0\\t565.0\\t0.519779208831647\\t715.0\\t0.657773689052438\\t1070.0\\t553.0\\t0.516822429906542\\t702.0\\t0.65607476635514\\t1\\n01100170112607\\t2014-2015\\t01\\t10017\\t0112607\\tAlameda\\tAlameda County Office of Education\\tEnvision Academy for Arts & Technology\\tCounty Office of Education (COE)\\tHigh Schools (Public)\\tTraditional\\tNone\\t1\\t0811\\tDirectly funded\\t1\\t9\\t12\\t395.0\\t186.0\\t0.470886075949367\\t186.0\\t0.470886075949367\\t376.0\\t182.0\\t0.484042553191489\\t182.0\\t0.484042553191489\\t1\\n01100170118489\\t2014-2015\\t01\\t10017\\t0118489\\tAlameda\\tAlameda County Office of Education\\tAspire California College Preparatory Academy\\tCounty Office of Education (COE)\\tHigh Schools (Public)\\tTraditional\\tNone\\t1\\t1049\\tDirectly funded\\t1\\t9\\t12\\t244.0\\t134.0\\t0.549180327868853\\t175.0\\t0.717213114754098\\t230.0\\t128.0\\t0.556521739130435\\t168.0\\t0.730434782608696\\t1\\n*/\\n\\n\\nCREATE TABLE satscores (\\n\\tcds TEXT NOT NULL, \\n\\trtype TEXT NOT NULL, \\n\\tsname TEXT, \\n\\tdname TEXT, \\n\\tcname TEXT, \\n\\tenroll12 INTEGER NOT NULL, \\n\\t\"NumTstTakr\" INTEGER NOT NULL, \\n\\t\"AvgScrRead\" INTEGER, \\n\\t\"AvgScrMath\" INTEGER, \\n\\t\"AvgScrWrite\" INTEGER, \\n\\t\"NumGE1500\" INTEGER, \\n\\tPRIMARY KEY (cds), \\n\\tFOREIGN KEY(cds) REFERENCES schools (\"CDSCode\")\\n)\\n\\n/*\\n3 rows from satscores table:\\ncds\\trtype\\tsname\\tdname\\tcname\\tenroll12\\tNumTstTakr\\tAvgScrRead\\tAvgScrMath\\tAvgScrWrite\\tNumGE1500\\n01100170000000\\tD\\tNone\\tAlameda County Office of Education\\tAlameda\\t398\\t88\\t418\\t418\\t417\\t14\\n01100170109835\\tS\\tFAME Public Charter\\tAlameda County Office of Education\\tAlameda\\t62\\t17\\t503\\t546\\t505\\t9\\n01100170112607\\tS\\tEnvision Academy for Arts & Technology\\tAlameda County Office of Education\\tAlameda\\t75\\t71\\t397\\t387\\t395\\t5\\n*/\\n\\n\\nCREATE TABLE schools (\\n\\t\"CDSCode\" TEXT NOT NULL, \\n\\t\"NCESDist\" TEXT, \\n\\t\"NCESSchool\" TEXT, \\n\\t\"StatusType\" TEXT NOT NULL, \\n\\t\"County\" TEXT NOT NULL, \\n\\t\"District\" TEXT NOT NULL, \\n\\t\"School\" TEXT, \\n\\t\"Street\" TEXT, \\n\\t\"StreetAbr\" TEXT, \\n\\t\"City\" TEXT, \\n\\t\"Zip\" TEXT, \\n\\t\"State\" TEXT, \\n\\t\"MailStreet\" TEXT, \\n\\t\"MailStrAbr\" TEXT, \\n\\t\"MailCity\" TEXT, \\n\\t\"MailZip\" TEXT, \\n\\t\"MailState\" TEXT, \\n\\t\"Phone\" TEXT, \\n\\t\"Ext\" TEXT, \\n\\t\"Website\" TEXT, \\n\\t\"OpenDate\" DATE, \\n\\t\"ClosedDate\" DATE, \\n\\t\"Charter\" INTEGER, \\n\\t\"CharterNum\" TEXT, \\n\\t\"FundingType\" TEXT, \\n\\t\"DOC\" TEXT NOT NULL, \\n\\t\"DOCType\" TEXT NOT NULL, \\n\\t\"SOC\" TEXT, \\n\\t\"SOCType\" TEXT, \\n\\t\"EdOpsCode\" TEXT, \\n\\t\"EdOpsName\" TEXT, \\n\\t\"EILCode\" TEXT, \\n\\t\"EILName\" TEXT, \\n\\t\"GSoffered\" TEXT, \\n\\t\"GSserved\" TEXT, \\n\\t\"Virtual\" TEXT, \\n\\t\"Magnet\" INTEGER, \\n\\t\"Latitude\" REAL, \\n\\t\"Longitude\" REAL, \\n\\t\"AdmFName1\" TEXT, \\n\\t\"AdmLName1\" TEXT, \\n\\t\"AdmEmail1\" TEXT, \\n\\t\"AdmFName2\" TEXT, \\n\\t\"AdmLName2\" TEXT, \\n\\t\"AdmEmail2\" TEXT, \\n\\t\"AdmFName3\" TEXT, \\n\\t\"AdmLName3\" TEXT, \\n\\t\"AdmEmail3\" TEXT, \\n\\t\"LastUpdate\" DATE NOT NULL, \\n\\tPRIMARY KEY (\"CDSCode\")\\n)\\n\\n/*\\n3 rows from schools table:\\nCDSCode\\tNCESDist\\tNCESSchool\\tStatusType\\tCounty\\tDistrict\\tSchool\\tStreet\\tStreetAbr\\tCity\\tZip\\tState\\tMailStreet\\tMailStrAbr\\tMailCity\\tMailZip\\tMailState\\tPhone\\tExt\\tWebsite\\tOpenDate\\tClosedDate\\tCharter\\tCharterNum\\tFundingType\\tDOC\\tDOCType\\tSOC\\tSOCType\\tEdOpsCode\\tEdOpsName\\tEILCode\\tEILName\\tGSoffered\\tGSserved\\tVirtual\\tMagnet\\tLatitude\\tLongitude\\tAdmFName1\\tAdmLName1\\tAdmEmail1\\tAdmFName2\\tAdmLName2\\tAdmEmail2\\tAdmFName3\\tAdmLName3\\tAdmEmail3\\tLastUpdate\\n01100170000000\\t0691051\\tNone\\tActive\\tAlameda\\tAlameda County Office of Education\\tNone\\t313 West Winton Avenue\\t313 West Winton Ave.\\tHayward\\t94544-1136\\tCA\\t313 West Winton Avenue\\t313 West Winton Ave.\\tHayward\\t94544-1136\\tCA\\t(510) 887-0152\\tNone\\twww.acoe.org\\tNone\\tNone\\tNone\\tNone\\tNone\\t00\\tCounty Office of Education (COE)\\tNone\\tNone\\tNone\\tNone\\tNone\\tNone\\tNone\\tNone\\tNone\\tNone\\t37.658212\\t-122.09713\\tL Karen\\tMonroe\\tlkmonroe@acoe.org\\tNone\\tNone\\tNone\\tNone\\tNone\\tNone\\t2015-06-23\\n01100170109835\\t0691051\\t10546\\tClosed\\tAlameda\\tAlameda County Office of Education\\tFAME Public Charter\\t39899 Balentine Drive, Suite 335\\t39899 Balentine Dr., Ste. 335\\tNewark\\t94560-5359\\tCA\\t39899 Balentine Drive, Suite 335\\t39899 Balentine Dr., Ste. 335\\tNewark\\t94560-5359\\tCA\\tNone\\tNone\\tNone\\t2005-08-29\\t2015-07-31\\t1\\t0728\\tDirectly funded\\t00\\tCounty Office of Education (COE)\\t65\\tK-12 Schools (Public)\\tTRAD\\tTraditional\\tELEMHIGH\\tElementary-High Combination\\tK-12\\tK-12\\tP\\t0\\t37.521436\\t-121.99391\\tNone\\tNone\\tNone\\tNone\\tNone\\tNone\\tNone\\tNone\\tNone\\t2015-09-01\\n01100170112607\\t0691051\\t10947\\tActive\\tAlameda\\tAlameda County Office of Education\\tEnvision Academy for Arts & Technology\\t1515 Webster Street\\t1515 Webster St.\\tOakland\\t94612-3355\\tCA\\t1515 Webster Street\\t1515 Webster St.\\tOakland\\t94612\\tCA\\t(510) 596-8901\\tNone\\twww.envisionacademy.org/\\t2006-08-28\\tNone\\t1\\t0811\\tDirectly funded\\t00\\tCounty Office of Education (COE)\\t66\\tHigh Schools (Public)\\tTRAD\\tTraditional\\tHS\\tHigh School\\t9-12\\t9-12\\tN\\t0\\t37.80452\\t-122.26815\\tLaura\\tRobell\\tlaura@envisionacademy.org\\tNone\\tNone\\tNone\\tNone\\tNone\\tNone\\t2015-06-18\\n*/\\n'},\n",
       " {'role': 'user',\n",
       "  'content': 'How many schools with an average score in Math greater than 400 in the SAT test are exclusively virtual?'}]"
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#| echo: true\n",
    "#| code-line-numbers: 4-10|11-14|19-23\n",
    "def generate_messages(question, dialect=\"SQL\", top_k=5, table_info=\"\"):\n",
    "    # Create a ChatPromptTemplate\n",
    "    messages = [\n",
    "      {\n",
    "        \"role\": \"system\", \n",
    "        \"content\": system_message.format(\n",
    "          dialect=dialect, \n",
    "          top_k=top_k, \n",
    "          table_info=table_info\n",
    "        )},\n",
    "      {\n",
    "        \"role\": \"user\", \n",
    "        \"content\": question\n",
    "      }\n",
    "    ]\n",
    "    \n",
    "    return messages\n",
    "\n",
    "messages = generate_messages(\n",
    "  question=question, \n",
    "  dialect=db.dialect, top_k=10, \n",
    "  table_info=db.get_table_info())\n",
    "messages"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "93290193",
   "metadata": {},
   "outputs": [],
   "source": [
    "#| echo: false\n",
    "import json\n",
    "with open(\"messages.json\", \"w\") as fp:\n",
    "    json.dump(messages, fp)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "32ce66d5",
   "metadata": {},
   "source": [
    "--- \n",
    "\n",
    "### üîé the `system` message"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "c0b225d3",
   "metadata": {
    "output-location": "default"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">\n",
       "Given an input question, create a \n",
       "syntactically correct sqlite query to\n",
       "run to help find the answer. Unless the user \n",
       "specifies in his question a\n",
       "specific number of examples they wish to \n",
       "obtain, always limit your query to\n",
       "at most <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10</span> results. You can order the results\n",
       "by a relevant column to\n",
       "return the most interesting examples in the \n",
       "database.\n",
       "\n",
       "Never query for all the columns from a \n",
       "specific table, only ask for a the\n",
       "few relevant columns given the question.\n",
       "\n",
       "Pay attention to use only the column names \n",
       "that you can see in the schema\n",
       "description. Be careful to not query for \n",
       "columns that do not exist. Also,\n",
       "pay attention to which column is in which \n",
       "table.\n",
       "\n",
       "Only use the following tables:\n",
       "\n",
       "CREATE TABLE frpm <span style=\"font-weight: bold\">(</span>\n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"CDSCode\"</span> TEXT NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Academic Year\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"County Code\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"District Code\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"School Code\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"County Name\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"District Name\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"School Name\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"District Type\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"School Type\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Educational Option Type\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"NSLP Provision Status\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Charter School (Y/N)\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Charter School Number\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Charter Funding Type\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"IRC\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Low Grade\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"High Grade\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Enrollment (K-12)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Free Meal Count (K-12)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Percent (%) Eligible Free (K-12)\"</span> \n",
       "REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"FRPM Count (K-12)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Percent (%) Eligible FRPM (K-12)\"</span> \n",
       "REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Enrollment (Ages 5-17)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Free Meal Count (Ages 5-17)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Percent (%) Eligible Free (Ages </span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">5-17)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"FRPM Count (Ages 5-17)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Percent (%) Eligible FRPM (Ages </span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">5-17)\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"2013-14 CALPADS Fall 1 Certification</span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">Status\"</span> INTEGER, \n",
       "        PRIMARY KEY <span style=\"font-weight: bold\">(</span><span style=\"color: #008000; text-decoration-color: #008000\">\"CDSCode\"</span><span style=\"font-weight: bold\">)</span>, \n",
       "        FOREIGN <span style=\"color: #800080; text-decoration-color: #800080; font-weight: bold\">KEY</span><span style=\"font-weight: bold\">(</span><span style=\"color: #008000; text-decoration-color: #008000\">\"CDSCode\"</span><span style=\"font-weight: bold\">)</span> REFERENCES \n",
       "schools <span style=\"font-weight: bold\">(</span><span style=\"color: #008000; text-decoration-color: #008000\">\"CDSCode\"</span><span style=\"font-weight: bold\">)</span>\n",
       "<span style=\"font-weight: bold\">)</span>\n",
       "\n",
       "<span style=\"color: #800080; text-decoration-color: #800080\">/</span>*\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span> rows from frpm table:\n",
       "CDSCode Academic Year   County Code     \n",
       "District Code   School Code     County Name  \n",
       "District Name   School Name     District Type\n",
       "School Type     Educational Option Type NSLP \n",
       "Provision Status   Charter School <span style=\"font-weight: bold\">(</span>Y/N<span style=\"font-weight: bold\">)</span>    \n",
       "Charter School Number   Charter Funding Type \n",
       "IRC     Low Grade       High Grade      \n",
       "Enrollment <span style=\"font-weight: bold\">(</span>K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span><span style=\"font-weight: bold\">)</span>       Free Meal Count \n",
       "<span style=\"font-weight: bold\">(</span>K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span><span style=\"font-weight: bold\">)</span>  Percent <span style=\"font-weight: bold\">(</span>%<span style=\"font-weight: bold\">)</span> Eligible Free <span style=\"font-weight: bold\">(</span>K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span><span style=\"font-weight: bold\">)</span>     \n",
       "FRPM Count <span style=\"font-weight: bold\">(</span>K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span><span style=\"font-weight: bold\">)</span>       Percent <span style=\"font-weight: bold\">(</span>%<span style=\"font-weight: bold\">)</span> Eligible \n",
       "FRPM <span style=\"font-weight: bold\">(</span>K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span><span style=\"font-weight: bold\">)</span>        Enrollment <span style=\"font-weight: bold\">(</span>Ages <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17</span><span style=\"font-weight: bold\">)</span>  \n",
       "Free Meal Count <span style=\"font-weight: bold\">(</span>Ages <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17</span><span style=\"font-weight: bold\">)</span>     Percent <span style=\"font-weight: bold\">(</span>%<span style=\"font-weight: bold\">)</span> \n",
       "Eligible Free <span style=\"font-weight: bold\">(</span>Ages <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17</span><span style=\"font-weight: bold\">)</span>   FRPM Count <span style=\"font-weight: bold\">(</span>Ages \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17</span><span style=\"font-weight: bold\">)</span>  Percent <span style=\"font-weight: bold\">(</span>%<span style=\"font-weight: bold\">)</span> Eligible FRPM <span style=\"font-weight: bold\">(</span>Ages <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17</span><span style=\"font-weight: bold\">)</span> \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2013</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">14</span> CALPADS Fall <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> Certification Status\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170109835</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2014</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2015</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10017</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0109835</span> Alameda Alameda County Office of \n",
       "Education      FAME Public Charter     County\n",
       "Office of Education <span style=\"font-weight: bold\">(</span>COE<span style=\"font-weight: bold\">)</span>        K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span> Schools\n",
       "<span style=\"font-weight: bold\">(</span>Public<span style=\"font-weight: bold\">)</span>   Traditional     <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0728</span>    Directly funded <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       K       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1087.0</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">565.0</span>   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.519779208831647</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">715.0</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.657773689052438</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1070.0</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">553.0</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.516822429906542</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">702.0</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.65607476635514</span>        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170112607</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2014</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2015</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10017</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0112607</span> Alameda Alameda County Office of \n",
       "Education      Envision Academy for Arts &amp; \n",
       "Technology  County Office of Education <span style=\"font-weight: bold\">(</span>COE<span style=\"font-weight: bold\">)</span> \n",
       "High Schools <span style=\"font-weight: bold\">(</span>Public<span style=\"font-weight: bold\">)</span>   Traditional     <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span> \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0811</span>    Directly funded <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span>    \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">395.0</span>   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">186.0</span>   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.470886075949367</span>    \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">186.0</span>   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.470886075949367</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">376.0</span>   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">182.0</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.484042553191489</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">182.0</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.484042553191489</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170118489</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2014</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2015</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10017</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0118489</span> Alameda Alameda County Office of \n",
       "Education      Aspire California College \n",
       "Preparatory Academy   County Office of \n",
       "Education <span style=\"font-weight: bold\">(</span>COE<span style=\"font-weight: bold\">)</span>        High Schools <span style=\"font-weight: bold\">(</span>Public<span style=\"font-weight: bold\">)</span> \n",
       "Traditional     <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1049</span>    \n",
       "Directly funded <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">244.0</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">134.0</span>   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.549180327868853</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">175.0</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.717213114754098</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">230.0</span>   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">128.0</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.556521739130435</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">168.0</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.730434782608696</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>\n",
       "*<span style=\"color: #800080; text-decoration-color: #800080\">/</span>\n",
       "\n",
       "\n",
       "CREATE TABLE satscores <span style=\"font-weight: bold\">(</span>\n",
       "        cds TEXT NOT NULL, \n",
       "        rtype TEXT NOT NULL, \n",
       "        sname TEXT, \n",
       "        dname TEXT, \n",
       "        cname TEXT, \n",
       "        enroll12 INTEGER NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"NumTstTakr\"</span> INTEGER NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AvgScrRead\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AvgScrMath\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AvgScrWrite\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"NumGE1500\"</span> INTEGER, \n",
       "        PRIMARY KEY <span style=\"font-weight: bold\">(</span>cds<span style=\"font-weight: bold\">)</span>, \n",
       "        FOREIGN <span style=\"color: #800080; text-decoration-color: #800080; font-weight: bold\">KEY</span><span style=\"font-weight: bold\">(</span>cds<span style=\"font-weight: bold\">)</span> REFERENCES schools \n",
       "<span style=\"font-weight: bold\">(</span><span style=\"color: #008000; text-decoration-color: #008000\">\"CDSCode\"</span><span style=\"font-weight: bold\">)</span>\n",
       "<span style=\"font-weight: bold\">)</span>\n",
       "\n",
       "<span style=\"color: #800080; text-decoration-color: #800080\">/</span>*\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span> rows from satscores table:\n",
       "cds     rtype   sname   dname   cname   \n",
       "enroll12        NumTstTakr      AvgScrRead   \n",
       "AvgScrMath      AvgScrWrite     NumGE1500\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170000000</span>  D       <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    Alameda \n",
       "County Office of Education      Alameda <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">398</span>  \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">88</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">418</span>     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">418</span>     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">417</span>     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">14</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170109835</span>  S       FAME Public Charter  \n",
       "Alameda County Office of Education      \n",
       "Alameda <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">62</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">503</span>     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">546</span>     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">505</span>  \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170112607</span>  S       Envision Academy for \n",
       "Arts &amp; Technology  Alameda County Office of \n",
       "Education      Alameda <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">75</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">71</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">397</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">387</span>     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">395</span>     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span>\n",
       "*<span style=\"color: #800080; text-decoration-color: #800080\">/</span>\n",
       "\n",
       "\n",
       "CREATE TABLE schools <span style=\"font-weight: bold\">(</span>\n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"CDSCode\"</span> TEXT NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"NCESDist\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"NCESSchool\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"StatusType\"</span> TEXT NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"County\"</span> TEXT NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"District\"</span> TEXT NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"School\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Street\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"StreetAbr\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"City\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Zip\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"State\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"MailStreet\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"MailStrAbr\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"MailCity\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"MailZip\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"MailState\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Phone\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Ext\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Website\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"OpenDate\"</span> DATE, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"ClosedDate\"</span> DATE, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Charter\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"CharterNum\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"FundingType\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"DOC\"</span> TEXT NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"DOCType\"</span> TEXT NOT NULL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"SOC\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"SOCType\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"EdOpsCode\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"EdOpsName\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"EILCode\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"EILName\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"GSoffered\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"GSserved\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Virtual\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Magnet\"</span> INTEGER, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Latitude\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"Longitude\"</span> REAL, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmFName1\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmLName1\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmEmail1\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmFName2\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmLName2\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmEmail2\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmFName3\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmLName3\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"AdmEmail3\"</span> TEXT, \n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">\"LastUpdate\"</span> DATE NOT NULL, \n",
       "        PRIMARY KEY <span style=\"font-weight: bold\">(</span><span style=\"color: #008000; text-decoration-color: #008000\">\"CDSCode\"</span><span style=\"font-weight: bold\">)</span>\n",
       "<span style=\"font-weight: bold\">)</span>\n",
       "\n",
       "<span style=\"color: #800080; text-decoration-color: #800080\">/</span>*\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span> rows from schools table:\n",
       "CDSCode NCESDist        NCESSchool      \n",
       "StatusType      County  District        \n",
       "School  Street  StreetAbr       City    Zip  \n",
       "State   MailStreet      MailStrAbr      \n",
       "MailCity        MailZip MailState       Phone\n",
       "Ext     Website OpenDate        ClosedDate   \n",
       "Charter CharterNum      FundingType     DOC  \n",
       "DOCType SOC     SOCType EdOpsCode       \n",
       "EdOpsName       EILCode EILName GSoffered    \n",
       "GSserved        Virtual Magnet  Latitude     \n",
       "Longitude       AdmFName1       AdmLName1    \n",
       "AdmEmail1       AdmFName2       AdmLName2    \n",
       "AdmEmail2       AdmFName3       AdmLName3    \n",
       "AdmEmail3       LastUpdate\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170000000</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0691051</span> <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    Active  \n",
       "Alameda Alameda County Office of Education   \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">313</span> West Winton Avenue  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">313</span> West \n",
       "Winton Ave.    Hayward <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">94544</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1136</span>      CA    \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">313</span> West Winton Avenue  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">313</span> West Winton Ave. \n",
       "Hayward <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">94544</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1136</span>      CA      <span style=\"font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">510</span><span style=\"font-weight: bold\">)</span> \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">887</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0152</span>  <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    www.acoe.org    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">00</span>      \n",
       "County Office of Education <span style=\"font-weight: bold\">(</span>COE<span style=\"font-weight: bold\">)</span>        <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span> \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span> \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">37.658212</span>       \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-122.09713</span>      L Karen Monroe  \n",
       "lkmonroe@acoe.org       <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span> \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2015</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">06</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">23</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170109835</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0691051</span> <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10546</span>   Closed  \n",
       "Alameda Alameda County Office of Education   \n",
       "FAME Public Charter     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39899</span> Balentine \n",
       "Drive, Suite <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">335</span>        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39899</span> Balentine Dr., \n",
       "Ste. <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">335</span>   Newark  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">94560</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5359</span>      CA      \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39899</span> Balentine Drive, Suite <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">335</span>        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39899</span>\n",
       "Balentine Dr., Ste. <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">335</span>   Newark  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">94560</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5359</span> \n",
       "CA      <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2005</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">08</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">29</span>   \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2015</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">07</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">31</span>      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0728</span>    Directly \n",
       "funded <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">00</span>      County Office of Education \n",
       "<span style=\"font-weight: bold\">(</span>COE<span style=\"font-weight: bold\">)</span>        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">65</span>      K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span> Schools <span style=\"font-weight: bold\">(</span>Public<span style=\"font-weight: bold\">)</span>   \n",
       "TRAD    Traditional     ELEMHIGH        \n",
       "Elementary-High Combination     K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span>    K-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span> \n",
       "P       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">37.521436</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-121.99391</span>   \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span> \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2015</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">09</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01</span>\n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">01100170112607</span>  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0691051</span> <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10947</span>   Active  \n",
       "Alameda Alameda County Office of Education   \n",
       "Envision Academy for Arts &amp; Technology  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1515</span> \n",
       "Webster Street     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1515</span> Webster St.        \n",
       "Oakland <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">94612</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3355</span>      CA      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1515</span> Webster \n",
       "Street     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1515</span> Webster St.        Oakland \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">94612</span>   CA      <span style=\"font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">510</span><span style=\"font-weight: bold\">)</span> <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">596</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8901</span>  <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    \n",
       "www.envisionacademy.org/        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2006</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">08</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">28</span>   \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0811</span>    Directly funded <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">00</span>   \n",
       "County Office of Education <span style=\"font-weight: bold\">(</span>COE<span style=\"font-weight: bold\">)</span>        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">66</span>   \n",
       "High Schools <span style=\"font-weight: bold\">(</span>Public<span style=\"font-weight: bold\">)</span>   TRAD    Traditional  \n",
       "HS      High School     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span>    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span>    N    \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span>       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">37.80452</span>        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-122.26815</span>      Laura\n",
       "Robell  laura@envisionacademy.org       <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span> \n",
       "<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>    \n",
       "<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2015</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">06</span>-<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">18</span>\n",
       "*<span style=\"color: #800080; text-decoration-color: #800080\">/</span>\n",
       "\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\n",
       "Given an input question, create a \n",
       "syntactically correct sqlite query to\n",
       "run to help find the answer. Unless the user \n",
       "specifies in his question a\n",
       "specific number of examples they wish to \n",
       "obtain, always limit your query to\n",
       "at most \u001b[1;36m10\u001b[0m results. You can order the results\n",
       "by a relevant column to\n",
       "return the most interesting examples in the \n",
       "database.\n",
       "\n",
       "Never query for all the columns from a \n",
       "specific table, only ask for a the\n",
       "few relevant columns given the question.\n",
       "\n",
       "Pay attention to use only the column names \n",
       "that you can see in the schema\n",
       "description. Be careful to not query for \n",
       "columns that do not exist. Also,\n",
       "pay attention to which column is in which \n",
       "table.\n",
       "\n",
       "Only use the following tables:\n",
       "\n",
       "CREATE TABLE frpm \u001b[1m(\u001b[0m\n",
       "        \u001b[32m\"CDSCode\"\u001b[0m TEXT NOT NULL, \n",
       "        \u001b[32m\"Academic Year\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"County Code\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"District Code\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"School Code\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"County Name\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"District Name\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"School Name\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"District Type\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"School Type\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Educational Option Type\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"NSLP Provision Status\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Charter School \u001b[0m\u001b[32m(\u001b[0m\u001b[32mY/N\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"Charter School Number\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Charter Funding Type\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"IRC\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"Low Grade\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"High Grade\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Enrollment \u001b[0m\u001b[32m(\u001b[0m\u001b[32mK-12\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"Free Meal Count \u001b[0m\u001b[32m(\u001b[0m\u001b[32mK-12\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"Percent \u001b[0m\u001b[32m(\u001b[0m\u001b[32m%\u001b[0m\u001b[32m)\u001b[0m\u001b[32m Eligible Free \u001b[0m\u001b[32m(\u001b[0m\u001b[32mK-12\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m \n",
       "REAL, \n",
       "        \u001b[32m\"FRPM Count \u001b[0m\u001b[32m(\u001b[0m\u001b[32mK-12\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"Percent \u001b[0m\u001b[32m(\u001b[0m\u001b[32m%\u001b[0m\u001b[32m)\u001b[0m\u001b[32m Eligible FRPM \u001b[0m\u001b[32m(\u001b[0m\u001b[32mK-12\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m \n",
       "REAL, \n",
       "        \u001b[32m\"Enrollment \u001b[0m\u001b[32m(\u001b[0m\u001b[32mAges 5-17\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"Free Meal Count \u001b[0m\u001b[32m(\u001b[0m\u001b[32mAges 5-17\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"Percent \u001b[0m\u001b[32m(\u001b[0m\u001b[32m%\u001b[0m\u001b[32m)\u001b[0m\u001b[32m Eligible Free \u001b[0m\u001b[32m(\u001b[0m\u001b[32mAges \u001b[0m\n",
       "\u001b[32m5-17\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"FRPM Count \u001b[0m\u001b[32m(\u001b[0m\u001b[32mAges 5-17\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"Percent \u001b[0m\u001b[32m(\u001b[0m\u001b[32m%\u001b[0m\u001b[32m)\u001b[0m\u001b[32m Eligible FRPM \u001b[0m\u001b[32m(\u001b[0m\u001b[32mAges \u001b[0m\n",
       "\u001b[32m5-17\u001b[0m\u001b[32m)\u001b[0m\u001b[32m\"\u001b[0m REAL, \n",
       "        \u001b[32m\"2013-14 CALPADS Fall 1 Certification\u001b[0m\n",
       "\u001b[32mStatus\"\u001b[0m INTEGER, \n",
       "        PRIMARY KEY \u001b[1m(\u001b[0m\u001b[32m\"CDSCode\"\u001b[0m\u001b[1m)\u001b[0m, \n",
       "        FOREIGN \u001b[1;35mKEY\u001b[0m\u001b[1m(\u001b[0m\u001b[32m\"CDSCode\"\u001b[0m\u001b[1m)\u001b[0m REFERENCES \n",
       "schools \u001b[1m(\u001b[0m\u001b[32m\"CDSCode\"\u001b[0m\u001b[1m)\u001b[0m\n",
       "\u001b[1m)\u001b[0m\n",
       "\n",
       "\u001b[35m/\u001b[0m*\n",
       "\u001b[1;36m3\u001b[0m rows from frpm table:\n",
       "CDSCode Academic Year   County Code     \n",
       "District Code   School Code     County Name  \n",
       "District Name   School Name     District Type\n",
       "School Type     Educational Option Type NSLP \n",
       "Provision Status   Charter School \u001b[1m(\u001b[0mY/N\u001b[1m)\u001b[0m    \n",
       "Charter School Number   Charter Funding Type \n",
       "IRC     Low Grade       High Grade      \n",
       "Enrollment \u001b[1m(\u001b[0mK-\u001b[1;36m12\u001b[0m\u001b[1m)\u001b[0m       Free Meal Count \n",
       "\u001b[1m(\u001b[0mK-\u001b[1;36m12\u001b[0m\u001b[1m)\u001b[0m  Percent \u001b[1m(\u001b[0m%\u001b[1m)\u001b[0m Eligible Free \u001b[1m(\u001b[0mK-\u001b[1;36m12\u001b[0m\u001b[1m)\u001b[0m     \n",
       "FRPM Count \u001b[1m(\u001b[0mK-\u001b[1;36m12\u001b[0m\u001b[1m)\u001b[0m       Percent \u001b[1m(\u001b[0m%\u001b[1m)\u001b[0m Eligible \n",
       "FRPM \u001b[1m(\u001b[0mK-\u001b[1;36m12\u001b[0m\u001b[1m)\u001b[0m        Enrollment \u001b[1m(\u001b[0mAges \u001b[1;36m5\u001b[0m-\u001b[1;36m17\u001b[0m\u001b[1m)\u001b[0m  \n",
       "Free Meal Count \u001b[1m(\u001b[0mAges \u001b[1;36m5\u001b[0m-\u001b[1;36m17\u001b[0m\u001b[1m)\u001b[0m     Percent \u001b[1m(\u001b[0m%\u001b[1m)\u001b[0m \n",
       "Eligible Free \u001b[1m(\u001b[0mAges \u001b[1;36m5\u001b[0m-\u001b[1;36m17\u001b[0m\u001b[1m)\u001b[0m   FRPM Count \u001b[1m(\u001b[0mAges \n",
       "\u001b[1;36m5\u001b[0m-\u001b[1;36m17\u001b[0m\u001b[1m)\u001b[0m  Percent \u001b[1m(\u001b[0m%\u001b[1m)\u001b[0m Eligible FRPM \u001b[1m(\u001b[0mAges \u001b[1;36m5\u001b[0m-\u001b[1;36m17\u001b[0m\u001b[1m)\u001b[0m \n",
       "\u001b[1;36m2013\u001b[0m-\u001b[1;36m14\u001b[0m CALPADS Fall \u001b[1;36m1\u001b[0m Certification Status\n",
       "\u001b[1;36m01100170109835\u001b[0m  \u001b[1;36m2014\u001b[0m-\u001b[1;36m2015\u001b[0m       \u001b[1;36m01\u001b[0m      \u001b[1;36m10017\u001b[0m\n",
       "\u001b[1;36m0109835\u001b[0m Alameda Alameda County Office of \n",
       "Education      FAME Public Charter     County\n",
       "Office of Education \u001b[1m(\u001b[0mCOE\u001b[1m)\u001b[0m        K-\u001b[1;36m12\u001b[0m Schools\n",
       "\u001b[1m(\u001b[0mPublic\u001b[1m)\u001b[0m   Traditional     \u001b[3;35mNone\u001b[0m    \u001b[1;36m1\u001b[0m       \n",
       "\u001b[1;36m0728\u001b[0m    Directly funded \u001b[1;36m1\u001b[0m       K       \u001b[1;36m12\u001b[0m   \n",
       "\u001b[1;36m1087.0\u001b[0m  \u001b[1;36m565.0\u001b[0m   \u001b[1;36m0.519779208831647\u001b[0m       \u001b[1;36m715.0\u001b[0m\n",
       "\u001b[1;36m0.657773689052438\u001b[0m       \u001b[1;36m1070.0\u001b[0m  \u001b[1;36m553.0\u001b[0m   \n",
       "\u001b[1;36m0.516822429906542\u001b[0m       \u001b[1;36m702.0\u001b[0m   \n",
       "\u001b[1;36m0.65607476635514\u001b[0m        \u001b[1;36m1\u001b[0m\n",
       "\u001b[1;36m01100170112607\u001b[0m  \u001b[1;36m2014\u001b[0m-\u001b[1;36m2015\u001b[0m       \u001b[1;36m01\u001b[0m      \u001b[1;36m10017\u001b[0m\n",
       "\u001b[1;36m0112607\u001b[0m Alameda Alameda County Office of \n",
       "Education      Envision Academy for Arts & \n",
       "Technology  County Office of Education \u001b[1m(\u001b[0mCOE\u001b[1m)\u001b[0m \n",
       "High Schools \u001b[1m(\u001b[0mPublic\u001b[1m)\u001b[0m   Traditional     \u001b[3;35mNone\u001b[0m \n",
       "\u001b[1;36m1\u001b[0m       \u001b[1;36m0811\u001b[0m    Directly funded \u001b[1;36m1\u001b[0m       \u001b[1;36m9\u001b[0m    \n",
       "\u001b[1;36m12\u001b[0m      \u001b[1;36m395.0\u001b[0m   \u001b[1;36m186.0\u001b[0m   \u001b[1;36m0.470886075949367\u001b[0m    \n",
       "\u001b[1;36m186.0\u001b[0m   \u001b[1;36m0.470886075949367\u001b[0m       \u001b[1;36m376.0\u001b[0m   \u001b[1;36m182.0\u001b[0m\n",
       "\u001b[1;36m0.484042553191489\u001b[0m       \u001b[1;36m182.0\u001b[0m   \n",
       "\u001b[1;36m0.484042553191489\u001b[0m       \u001b[1;36m1\u001b[0m\n",
       "\u001b[1;36m01100170118489\u001b[0m  \u001b[1;36m2014\u001b[0m-\u001b[1;36m2015\u001b[0m       \u001b[1;36m01\u001b[0m      \u001b[1;36m10017\u001b[0m\n",
       "\u001b[1;36m0118489\u001b[0m Alameda Alameda County Office of \n",
       "Education      Aspire California College \n",
       "Preparatory Academy   County Office of \n",
       "Education \u001b[1m(\u001b[0mCOE\u001b[1m)\u001b[0m        High Schools \u001b[1m(\u001b[0mPublic\u001b[1m)\u001b[0m \n",
       "Traditional     \u001b[3;35mNone\u001b[0m    \u001b[1;36m1\u001b[0m       \u001b[1;36m1049\u001b[0m    \n",
       "Directly funded \u001b[1;36m1\u001b[0m       \u001b[1;36m9\u001b[0m       \u001b[1;36m12\u001b[0m      \u001b[1;36m244.0\u001b[0m\n",
       "\u001b[1;36m134.0\u001b[0m   \u001b[1;36m0.549180327868853\u001b[0m       \u001b[1;36m175.0\u001b[0m   \n",
       "\u001b[1;36m0.717213114754098\u001b[0m       \u001b[1;36m230.0\u001b[0m   \u001b[1;36m128.0\u001b[0m   \n",
       "\u001b[1;36m0.556521739130435\u001b[0m       \u001b[1;36m168.0\u001b[0m   \n",
       "\u001b[1;36m0.730434782608696\u001b[0m       \u001b[1;36m1\u001b[0m\n",
       "*\u001b[35m/\u001b[0m\n",
       "\n",
       "\n",
       "CREATE TABLE satscores \u001b[1m(\u001b[0m\n",
       "        cds TEXT NOT NULL, \n",
       "        rtype TEXT NOT NULL, \n",
       "        sname TEXT, \n",
       "        dname TEXT, \n",
       "        cname TEXT, \n",
       "        enroll12 INTEGER NOT NULL, \n",
       "        \u001b[32m\"NumTstTakr\"\u001b[0m INTEGER NOT NULL, \n",
       "        \u001b[32m\"AvgScrRead\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"AvgScrMath\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"AvgScrWrite\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"NumGE1500\"\u001b[0m INTEGER, \n",
       "        PRIMARY KEY \u001b[1m(\u001b[0mcds\u001b[1m)\u001b[0m, \n",
       "        FOREIGN \u001b[1;35mKEY\u001b[0m\u001b[1m(\u001b[0mcds\u001b[1m)\u001b[0m REFERENCES schools \n",
       "\u001b[1m(\u001b[0m\u001b[32m\"CDSCode\"\u001b[0m\u001b[1m)\u001b[0m\n",
       "\u001b[1m)\u001b[0m\n",
       "\n",
       "\u001b[35m/\u001b[0m*\n",
       "\u001b[1;36m3\u001b[0m rows from satscores table:\n",
       "cds     rtype   sname   dname   cname   \n",
       "enroll12        NumTstTakr      AvgScrRead   \n",
       "AvgScrMath      AvgScrWrite     NumGE1500\n",
       "\u001b[1;36m01100170000000\u001b[0m  D       \u001b[3;35mNone\u001b[0m    Alameda \n",
       "County Office of Education      Alameda \u001b[1;36m398\u001b[0m  \n",
       "\u001b[1;36m88\u001b[0m      \u001b[1;36m418\u001b[0m     \u001b[1;36m418\u001b[0m     \u001b[1;36m417\u001b[0m     \u001b[1;36m14\u001b[0m\n",
       "\u001b[1;36m01100170109835\u001b[0m  S       FAME Public Charter  \n",
       "Alameda County Office of Education      \n",
       "Alameda \u001b[1;36m62\u001b[0m      \u001b[1;36m17\u001b[0m      \u001b[1;36m503\u001b[0m     \u001b[1;36m546\u001b[0m     \u001b[1;36m505\u001b[0m  \n",
       "\u001b[1;36m9\u001b[0m\n",
       "\u001b[1;36m01100170112607\u001b[0m  S       Envision Academy for \n",
       "Arts & Technology  Alameda County Office of \n",
       "Education      Alameda \u001b[1;36m75\u001b[0m      \u001b[1;36m71\u001b[0m      \u001b[1;36m397\u001b[0m   \n",
       "\u001b[1;36m387\u001b[0m     \u001b[1;36m395\u001b[0m     \u001b[1;36m5\u001b[0m\n",
       "*\u001b[35m/\u001b[0m\n",
       "\n",
       "\n",
       "CREATE TABLE schools \u001b[1m(\u001b[0m\n",
       "        \u001b[32m\"CDSCode\"\u001b[0m TEXT NOT NULL, \n",
       "        \u001b[32m\"NCESDist\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"NCESSchool\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"StatusType\"\u001b[0m TEXT NOT NULL, \n",
       "        \u001b[32m\"County\"\u001b[0m TEXT NOT NULL, \n",
       "        \u001b[32m\"District\"\u001b[0m TEXT NOT NULL, \n",
       "        \u001b[32m\"School\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Street\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"StreetAbr\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"City\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Zip\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"State\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"MailStreet\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"MailStrAbr\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"MailCity\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"MailZip\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"MailState\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Phone\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Ext\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Website\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"OpenDate\"\u001b[0m DATE, \n",
       "        \u001b[32m\"ClosedDate\"\u001b[0m DATE, \n",
       "        \u001b[32m\"Charter\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"CharterNum\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"FundingType\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"DOC\"\u001b[0m TEXT NOT NULL, \n",
       "        \u001b[32m\"DOCType\"\u001b[0m TEXT NOT NULL, \n",
       "        \u001b[32m\"SOC\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"SOCType\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"EdOpsCode\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"EdOpsName\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"EILCode\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"EILName\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"GSoffered\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"GSserved\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Virtual\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"Magnet\"\u001b[0m INTEGER, \n",
       "        \u001b[32m\"Latitude\"\u001b[0m REAL, \n",
       "        \u001b[32m\"Longitude\"\u001b[0m REAL, \n",
       "        \u001b[32m\"AdmFName1\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmLName1\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmEmail1\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmFName2\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmLName2\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmEmail2\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmFName3\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmLName3\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"AdmEmail3\"\u001b[0m TEXT, \n",
       "        \u001b[32m\"LastUpdate\"\u001b[0m DATE NOT NULL, \n",
       "        PRIMARY KEY \u001b[1m(\u001b[0m\u001b[32m\"CDSCode\"\u001b[0m\u001b[1m)\u001b[0m\n",
       "\u001b[1m)\u001b[0m\n",
       "\n",
       "\u001b[35m/\u001b[0m*\n",
       "\u001b[1;36m3\u001b[0m rows from schools table:\n",
       "CDSCode NCESDist        NCESSchool      \n",
       "StatusType      County  District        \n",
       "School  Street  StreetAbr       City    Zip  \n",
       "State   MailStreet      MailStrAbr      \n",
       "MailCity        MailZip MailState       Phone\n",
       "Ext     Website OpenDate        ClosedDate   \n",
       "Charter CharterNum      FundingType     DOC  \n",
       "DOCType SOC     SOCType EdOpsCode       \n",
       "EdOpsName       EILCode EILName GSoffered    \n",
       "GSserved        Virtual Magnet  Latitude     \n",
       "Longitude       AdmFName1       AdmLName1    \n",
       "AdmEmail1       AdmFName2       AdmLName2    \n",
       "AdmEmail2       AdmFName3       AdmLName3    \n",
       "AdmEmail3       LastUpdate\n",
       "\u001b[1;36m01100170000000\u001b[0m  \u001b[1;36m0691051\u001b[0m \u001b[3;35mNone\u001b[0m    Active  \n",
       "Alameda Alameda County Office of Education   \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[1;36m313\u001b[0m West Winton Avenue  \u001b[1;36m313\u001b[0m West \n",
       "Winton Ave.    Hayward \u001b[1;36m94544\u001b[0m-\u001b[1;36m1136\u001b[0m      CA    \n",
       "\u001b[1;36m313\u001b[0m West Winton Avenue  \u001b[1;36m313\u001b[0m West Winton Ave. \n",
       "Hayward \u001b[1;36m94544\u001b[0m-\u001b[1;36m1136\u001b[0m      CA      \u001b[1m(\u001b[0m\u001b[1;36m510\u001b[0m\u001b[1m)\u001b[0m \n",
       "\u001b[1;36m887\u001b[0m-\u001b[1;36m0152\u001b[0m  \u001b[3;35mNone\u001b[0m    www.acoe.org    \u001b[3;35mNone\u001b[0m    \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[1;36m00\u001b[0m      \n",
       "County Office of Education \u001b[1m(\u001b[0mCOE\u001b[1m)\u001b[0m        \u001b[3;35mNone\u001b[0m \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[1;36m37.658212\u001b[0m       \n",
       "\u001b[1;36m-122.09713\u001b[0m      L Karen Monroe  \n",
       "lkmonroe@acoe.org       \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[1;36m2015\u001b[0m-\u001b[1;36m06\u001b[0m-\u001b[1;36m23\u001b[0m\n",
       "\u001b[1;36m01100170109835\u001b[0m  \u001b[1;36m0691051\u001b[0m \u001b[1;36m10546\u001b[0m   Closed  \n",
       "Alameda Alameda County Office of Education   \n",
       "FAME Public Charter     \u001b[1;36m39899\u001b[0m Balentine \n",
       "Drive, Suite \u001b[1;36m335\u001b[0m        \u001b[1;36m39899\u001b[0m Balentine Dr., \n",
       "Ste. \u001b[1;36m335\u001b[0m   Newark  \u001b[1;36m94560\u001b[0m-\u001b[1;36m5359\u001b[0m      CA      \n",
       "\u001b[1;36m39899\u001b[0m Balentine Drive, Suite \u001b[1;36m335\u001b[0m        \u001b[1;36m39899\u001b[0m\n",
       "Balentine Dr., Ste. \u001b[1;36m335\u001b[0m   Newark  \u001b[1;36m94560\u001b[0m-\u001b[1;36m5359\u001b[0m \n",
       "CA      \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[1;36m2005\u001b[0m-\u001b[1;36m08\u001b[0m-\u001b[1;36m29\u001b[0m   \n",
       "\u001b[1;36m2015\u001b[0m-\u001b[1;36m07\u001b[0m-\u001b[1;36m31\u001b[0m      \u001b[1;36m1\u001b[0m       \u001b[1;36m0728\u001b[0m    Directly \n",
       "funded \u001b[1;36m00\u001b[0m      County Office of Education \n",
       "\u001b[1m(\u001b[0mCOE\u001b[1m)\u001b[0m        \u001b[1;36m65\u001b[0m      K-\u001b[1;36m12\u001b[0m Schools \u001b[1m(\u001b[0mPublic\u001b[1m)\u001b[0m   \n",
       "TRAD    Traditional     ELEMHIGH        \n",
       "Elementary-High Combination     K-\u001b[1;36m12\u001b[0m    K-\u001b[1;36m12\u001b[0m \n",
       "P       \u001b[1;36m0\u001b[0m       \u001b[1;36m37.521436\u001b[0m       \u001b[1;36m-121.99391\u001b[0m   \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[1;36m2015\u001b[0m-\u001b[1;36m09\u001b[0m-\u001b[1;36m01\u001b[0m\n",
       "\u001b[1;36m01100170112607\u001b[0m  \u001b[1;36m0691051\u001b[0m \u001b[1;36m10947\u001b[0m   Active  \n",
       "Alameda Alameda County Office of Education   \n",
       "Envision Academy for Arts & Technology  \u001b[1;36m1515\u001b[0m \n",
       "Webster Street     \u001b[1;36m1515\u001b[0m Webster St.        \n",
       "Oakland \u001b[1;36m94612\u001b[0m-\u001b[1;36m3355\u001b[0m      CA      \u001b[1;36m1515\u001b[0m Webster \n",
       "Street     \u001b[1;36m1515\u001b[0m Webster St.        Oakland \n",
       "\u001b[1;36m94612\u001b[0m   CA      \u001b[1m(\u001b[0m\u001b[1;36m510\u001b[0m\u001b[1m)\u001b[0m \u001b[1;36m596\u001b[0m-\u001b[1;36m8901\u001b[0m  \u001b[3;35mNone\u001b[0m    \n",
       "www.envisionacademy.org/        \u001b[1;36m2006\u001b[0m-\u001b[1;36m08\u001b[0m-\u001b[1;36m28\u001b[0m   \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[1;36m1\u001b[0m       \u001b[1;36m0811\u001b[0m    Directly funded \u001b[1;36m00\u001b[0m   \n",
       "County Office of Education \u001b[1m(\u001b[0mCOE\u001b[1m)\u001b[0m        \u001b[1;36m66\u001b[0m   \n",
       "High Schools \u001b[1m(\u001b[0mPublic\u001b[1m)\u001b[0m   TRAD    Traditional  \n",
       "HS      High School     \u001b[1;36m9\u001b[0m-\u001b[1;36m12\u001b[0m    \u001b[1;36m9\u001b[0m-\u001b[1;36m12\u001b[0m    N    \n",
       "\u001b[1;36m0\u001b[0m       \u001b[1;36m37.80452\u001b[0m        \u001b[1;36m-122.26815\u001b[0m      Laura\n",
       "Robell  laura@envisionacademy.org       \u001b[3;35mNone\u001b[0m \n",
       "\u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \u001b[3;35mNone\u001b[0m    \n",
       "\u001b[1;36m2015\u001b[0m-\u001b[1;36m06\u001b[0m-\u001b[1;36m18\u001b[0m\n",
       "*\u001b[35m/\u001b[0m\n",
       "\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "#| echo: false\n",
    "#| classes: scrollable\n",
    "print(messages[0]['content'])"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "098b67e5",
   "metadata": {},
   "source": [
    "::: footer\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "## Calling the LLM with the prompt {.smaller}\n",
    "\n",
    "`litellm` is a Open Source Python library (and also a Proxy) that can be\n",
    "used to run inference and compute embeddings with a vast number\n",
    "of providers (new models added weekly).\n",
    "\n",
    "Among the provider lists we have:\n",
    "\n",
    "::: {.incremental}\n",
    "\n",
    "- Ollama / LMStudio / llama.cpp\n",
    "- IBM WatsonX.ai\n",
    "- Anthropic\n",
    "- OpenAI\n",
    "- AWS Sagemaker\n",
    "- OpenRouter\n",
    "- [and more {{< bi info-circle >}}](https://docs.litellm.ai/docs/providers)\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "### Using litellm\n",
    "\n",
    "::: {.fragment .fade-in-then-semi-out}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "6432dc2f",
   "metadata": {},
   "outputs": [],
   "source": [
    "#| echo: true\n",
    "!uv add litellm --quiet"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fe9e0666",
   "metadata": {},
   "source": [
    ":::\n",
    "\n",
    "<!-- [^extras]:   \n",
    "  `caching` , `extra-proxy` , `mlflow` , `proxy` , `semantic-router`, `utils` -->\n",
    "\n",
    "\n",
    "::: {.fragment .fade-in}\n",
    "To run inference, we just call the [`completions`](https://docs.litellm.ai/docs/completion/input) function:\n",
    "\n",
    "<!-- Enable disk cachesq -->"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "ed13abf3",
   "metadata": {},
   "outputs": [],
   "source": [
    "#| echo: false\n",
    "# Speed up execution\n",
    "import litellm \n",
    "\n",
    "from litellm.caching.caching import Cache\n",
    "litellm.cache = Cache(type=\"disk\")\n",
    "# Remove debug messages\n",
    "litellm.suppress_debug_info = True"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "9f64fba5",
   "metadata": {},
   "outputs": [],
   "source": [
    "#| echo: true\n",
    "\n",
    "import litellm\n",
    "\n",
    "# provider/model (if not local, ensure you have API üîë )\n",
    "model = \"watsonx/ibm/granite-3-2-8b-instruct\"\n",
    "\n",
    "response = litellm.completion(\n",
    "  model=model,\n",
    "  messages=messages,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "887b0e17",
   "metadata": {},
   "source": [
    ":::\n",
    "\n",
    "\n",
    "::: notes\n",
    "\n",
    "There are some reasonably good LLMs under the coder and instruct in Hugging Face\n",
    "Some of these can be run locally with some inference server like `Ollama`, \n",
    "`llama.cpp` or `LMStudio`, and also use pubic \n",
    "ones\n",
    "\n",
    ":::\n",
    "\n",
    "---"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "8aaa6669",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #800080; text-decoration-color: #800080; font-weight: bold\">ModelResponse</span><span style=\"font-weight: bold\">(</span>\n",
       "    <span style=\"color: #808000; text-decoration-color: #808000\">id</span>=<span style=\"color: #008000; text-decoration-color: #008000\">'chatcmpl-f79a3df0-2506-4e7e-aa2b-b65d</span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">21f5d680---5976a0e7cf57f032504389f213b02431--</span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">-e4f953c6-f9cd-4161-bccf-1f1fd819ea7b'</span>,\n",
       "    <span style=\"color: #808000; text-decoration-color: #808000\">created</span>=<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1758486227</span>,\n",
       "    <span style=\"color: #808000; text-decoration-color: #808000\">model</span>=<span style=\"color: #008000; text-decoration-color: #008000\">'watsonx/ibm/granite-3-2-8b-instruc</span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">t'</span>,\n",
       "    <span style=\"color: #808000; text-decoration-color: #808000\">object</span>=<span style=\"color: #008000; text-decoration-color: #008000\">'chat.completion'</span>,\n",
       "    <span style=\"color: #808000; text-decoration-color: #808000\">system_fingerprint</span>=<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>,\n",
       "    <span style=\"color: #808000; text-decoration-color: #808000\">choices</span>=<span style=\"font-weight: bold\">[</span>\n",
       "        <span style=\"color: #800080; text-decoration-color: #800080; font-weight: bold\">Choices</span><span style=\"font-weight: bold\">(</span>\n",
       "            <span style=\"color: #808000; text-decoration-color: #808000\">finish_reason</span>=<span style=\"color: #008000; text-decoration-color: #008000\">'stop'</span>,\n",
       "            <span style=\"color: #808000; text-decoration-color: #808000\">index</span>=<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span>,\n",
       "            <span style=\"color: #808000; text-decoration-color: #808000\">message</span>=<span style=\"color: #800080; text-decoration-color: #800080; font-weight: bold\">Message</span><span style=\"font-weight: bold\">(</span>\n",
       "                <span style=\"color: #808000; text-decoration-color: #808000\">content</span>=<span style=\"color: #008000; text-decoration-color: #008000\">'SELECT COUNT(*) FROM</span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">schools\\nINNER JOIN frpm ON schools.CDSCode =</span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">frpm.CDSCode\\nINNER JOIN satscores ON </span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">schools.CDSCode = satscores.cds\\nWHERE </span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">satscores.\"AvgScrMath\" &gt; 400\\nAND </span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">schools.Virtual = \\'Y\\'\\nAND schools.Magnet =</span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">0\\nAND frpm.CharterSchool(Y/N) = 0\\nLIMIT </span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">10;'</span>,\n",
       "                <span style=\"color: #808000; text-decoration-color: #808000\">role</span>=<span style=\"color: #008000; text-decoration-color: #008000\">'assistant'</span>,\n",
       "                <span style=\"color: #808000; text-decoration-color: #808000\">tool_calls</span>=<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>,\n",
       "                <span style=\"color: #808000; text-decoration-color: #808000\">function_call</span>=<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>,\n",
       "                <span style=\"color: #808000; text-decoration-color: #808000\">provider_specific_fields</span>=<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>\n",
       "            <span style=\"font-weight: bold\">)</span>\n",
       "        <span style=\"font-weight: bold\">)</span>\n",
       "    <span style=\"font-weight: bold\">]</span>,\n",
       "    <span style=\"color: #808000; text-decoration-color: #808000\">usage</span>=<span style=\"color: #800080; text-decoration-color: #800080; font-weight: bold\">Usage</span><span style=\"font-weight: bold\">(</span>\n",
       "        <span style=\"color: #808000; text-decoration-color: #808000\">completion_tokens</span>=<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">102</span>,\n",
       "        <span style=\"color: #808000; text-decoration-color: #808000\">prompt_tokens</span>=<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3259</span>,\n",
       "        <span style=\"color: #808000; text-decoration-color: #808000\">total_tokens</span>=<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3361</span>,\n",
       "        <span style=\"color: #808000; text-decoration-color: #808000\">completion_tokens_details</span>=<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>,\n",
       "        <span style=\"color: #808000; text-decoration-color: #808000\">prompt_tokens_details</span>=<span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>\n",
       "    <span style=\"font-weight: bold\">)</span>,\n",
       "    <span style=\"color: #808000; text-decoration-color: #808000\">model_id</span>=<span style=\"color: #008000; text-decoration-color: #008000\">'ibm/granite-3-2-8b-instruct'</span>,\n",
       "    <span style=\"color: #808000; text-decoration-color: #808000\">model_version</span>=<span style=\"color: #008000; text-decoration-color: #008000\">'1.0.0'</span>,\n",
       "    <span style=\"color: #808000; text-decoration-color: #808000\">created_at</span>=<span style=\"color: #008000; text-decoration-color: #008000\">'2025-09-21T20:23:48.449Z'</span>,\n",
       "    <span style=\"color: #808000; text-decoration-color: #808000\">system</span>=<span style=\"font-weight: bold\">{</span>\n",
       "        <span style=\"color: #008000; text-decoration-color: #008000\">'warnings'</span>: <span style=\"font-weight: bold\">[</span>\n",
       "            <span style=\"font-weight: bold\">{</span>\n",
       "                <span style=\"color: #008000; text-decoration-color: #008000\">'message'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">\"The value of </span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">'max_completion_tokens' for this model was </span>\n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">set to value 1024\"</span>,\n",
       "                <span style=\"color: #008000; text-decoration-color: #008000\">'id'</span>: \n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">'unspecified_max_completion_tokens'</span>,\n",
       "                <span style=\"color: #008000; text-decoration-color: #008000\">'additional_properties'</span>: <span style=\"font-weight: bold\">{</span>\n",
       "                    <span style=\"color: #008000; text-decoration-color: #008000\">'limit'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span>,\n",
       "                    <span style=\"color: #008000; text-decoration-color: #008000\">'new_value'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1024</span>,\n",
       "                    <span style=\"color: #008000; text-decoration-color: #008000\">'parameter'</span>: \n",
       "<span style=\"color: #008000; text-decoration-color: #008000\">'max_completion_tokens'</span>,\n",
       "                    <span style=\"color: #008000; text-decoration-color: #008000\">'value'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span>\n",
       "                <span style=\"font-weight: bold\">}</span>\n",
       "            <span style=\"font-weight: bold\">}</span>\n",
       "        <span style=\"font-weight: bold\">]</span>\n",
       "    <span style=\"font-weight: bold\">}</span>\n",
       "<span style=\"font-weight: bold\">)</span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[1;35mModelResponse\u001b[0m\u001b[1m(\u001b[0m\n",
       "    \u001b[33mid\u001b[0m=\u001b[32m'chatcmpl-f79a3df0-2506-4e7e-aa2b-b65d\u001b[0m\n",
       "\u001b[32m21f5d680---5976a0e7cf57f032504389f213b02431--\u001b[0m\n",
       "\u001b[32m-e4f953c6-f9cd-4161-bccf-1f1fd819ea7b'\u001b[0m,\n",
       "    \u001b[33mcreated\u001b[0m=\u001b[1;36m1758486227\u001b[0m,\n",
       "    \u001b[33mmodel\u001b[0m=\u001b[32m'watsonx/ibm/granite-3-2-8b-instruc\u001b[0m\n",
       "\u001b[32mt'\u001b[0m,\n",
       "    \u001b[33mobject\u001b[0m=\u001b[32m'chat.completion'\u001b[0m,\n",
       "    \u001b[33msystem_fingerprint\u001b[0m=\u001b[3;35mNone\u001b[0m,\n",
       "    \u001b[33mchoices\u001b[0m=\u001b[1m[\u001b[0m\n",
       "        \u001b[1;35mChoices\u001b[0m\u001b[1m(\u001b[0m\n",
       "            \u001b[33mfinish_reason\u001b[0m=\u001b[32m'stop'\u001b[0m,\n",
       "            \u001b[33mindex\u001b[0m=\u001b[1;36m0\u001b[0m,\n",
       "            \u001b[33mmessage\u001b[0m=\u001b[1;35mMessage\u001b[0m\u001b[1m(\u001b[0m\n",
       "                \u001b[33mcontent\u001b[0m=\u001b[32m'SELECT COUNT\u001b[0m\u001b[32m(\u001b[0m\u001b[32m*\u001b[0m\u001b[32m)\u001b[0m\u001b[32m FROM\u001b[0m\n",
       "\u001b[32mschools\\nINNER JOIN frpm ON schools.CDSCode =\u001b[0m\n",
       "\u001b[32mfrpm.CDSCode\\nINNER JOIN satscores ON \u001b[0m\n",
       "\u001b[32mschools.CDSCode = satscores.cds\\nWHERE \u001b[0m\n",
       "\u001b[32msatscores.\"AvgScrMath\" > 400\\nAND \u001b[0m\n",
       "\u001b[32mschools.Virtual = \\'Y\\'\\nAND schools.Magnet =\u001b[0m\n",
       "\u001b[32m0\\nAND frpm.CharterSchool\u001b[0m\u001b[32m(\u001b[0m\u001b[32mY/N\u001b[0m\u001b[32m)\u001b[0m\u001b[32m = 0\\nLIMIT \u001b[0m\n",
       "\u001b[32m10;'\u001b[0m,\n",
       "                \u001b[33mrole\u001b[0m=\u001b[32m'assistant'\u001b[0m,\n",
       "                \u001b[33mtool_calls\u001b[0m=\u001b[3;35mNone\u001b[0m,\n",
       "                \u001b[33mfunction_call\u001b[0m=\u001b[3;35mNone\u001b[0m,\n",
       "                \u001b[33mprovider_specific_fields\u001b[0m=\u001b[3;35mNone\u001b[0m\n",
       "            \u001b[1m)\u001b[0m\n",
       "        \u001b[1m)\u001b[0m\n",
       "    \u001b[1m]\u001b[0m,\n",
       "    \u001b[33musage\u001b[0m=\u001b[1;35mUsage\u001b[0m\u001b[1m(\u001b[0m\n",
       "        \u001b[33mcompletion_tokens\u001b[0m=\u001b[1;36m102\u001b[0m,\n",
       "        \u001b[33mprompt_tokens\u001b[0m=\u001b[1;36m3259\u001b[0m,\n",
       "        \u001b[33mtotal_tokens\u001b[0m=\u001b[1;36m3361\u001b[0m,\n",
       "        \u001b[33mcompletion_tokens_details\u001b[0m=\u001b[3;35mNone\u001b[0m,\n",
       "        \u001b[33mprompt_tokens_details\u001b[0m=\u001b[3;35mNone\u001b[0m\n",
       "    \u001b[1m)\u001b[0m,\n",
       "    \u001b[33mmodel_id\u001b[0m=\u001b[32m'ibm/granite-3-2-8b-instruct'\u001b[0m,\n",
       "    \u001b[33mmodel_version\u001b[0m=\u001b[32m'1.0.0'\u001b[0m,\n",
       "    \u001b[33mcreated_at\u001b[0m=\u001b[32m'2025-09-21T20:23:48.449Z'\u001b[0m,\n",
       "    \u001b[33msystem\u001b[0m=\u001b[1m{\u001b[0m\n",
       "        \u001b[32m'warnings'\u001b[0m: \u001b[1m[\u001b[0m\n",
       "            \u001b[1m{\u001b[0m\n",
       "                \u001b[32m'message'\u001b[0m: \u001b[32m\"The value of \u001b[0m\n",
       "\u001b[32m'max_completion_tokens' for this model was \u001b[0m\n",
       "\u001b[32mset to value 1024\"\u001b[0m,\n",
       "                \u001b[32m'id'\u001b[0m: \n",
       "\u001b[32m'unspecified_max_completion_tokens'\u001b[0m,\n",
       "                \u001b[32m'additional_properties'\u001b[0m: \u001b[1m{\u001b[0m\n",
       "                    \u001b[32m'limit'\u001b[0m: \u001b[1;36m0\u001b[0m,\n",
       "                    \u001b[32m'new_value'\u001b[0m: \u001b[1;36m1024\u001b[0m,\n",
       "                    \u001b[32m'parameter'\u001b[0m: \n",
       "\u001b[32m'max_completion_tokens'\u001b[0m,\n",
       "                    \u001b[32m'value'\u001b[0m: \u001b[1;36m0\u001b[0m\n",
       "                \u001b[1m}\u001b[0m\n",
       "            \u001b[1m}\u001b[0m\n",
       "        \u001b[1m]\u001b[0m\n",
       "    \u001b[1m}\u001b[0m\n",
       "\u001b[1m)\u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "#| echo: true\n",
    "#| classes: scrollable\n",
    "print(response)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "92cd7616",
   "metadata": {},
   "source": [
    "---\n",
    "\n",
    "## Structured output {.smaller}\n",
    "\n",
    "::: {.fragment}\n",
    "LLM outputs are text, SQL for our use case.\n",
    "\n",
    "It's a good UX to give some explanation to the user about the LLM output. \n",
    "We will use `JSON Schema` output to have both output without any string manipulation ‚ú®\n",
    ":::\n",
    "\n",
    "::: {.fragment}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "812afb3b",
   "metadata": {},
   "outputs": [],
   "source": [
    "#| echo: true\n",
    "#| code-line-numbers: \"1|2-5|9-13|14-17\"\n",
    "\n",
    "from pydantic import BaseModel, Field\n",
    "class SQLOutput(BaseModel):\n",
    "    sql: str = Field(description=\"The SQL query\")\n",
    "    explanation: str = Field(\n",
    "      description=\"The reasoning for the query construction\")\n",
    "\n",
    "# Optional \n",
    "# litellm.enable_json_schema_validation = True\n",
    "\n",
    "response = litellm.completion(\n",
    "  model=model,\n",
    "  messages=messages,\n",
    "  response_format=SQLOutput,\n",
    ")\n",
    "output = SQLOutput.model_validate_json(\n",
    "  response.choices[0].message.content)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1ed620b9",
   "metadata": {},
   "source": [
    ":::\n",
    "---\n",
    "\n",
    "### Attributes of `output` object\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "id": "768393b0",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "\"SELECT COUNT(*) FROM schools INNER JOIN satscores ON schools.CDSCode = satscores.cds WHERE schools.Virtual = 'Y' AND satscores.AvgScrMath > 400;\""
      ]
     },
     "execution_count": 24,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#| echo: true\n",
    "output.sql"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "51b3e8d7",
   "metadata": {},
   "source": [
    "::: {.fragment}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "1c22cca6",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "\"The query selects the count of virtual schools from the 'schools' table that have a 'Virtual' column value of 'Y' and an 'AvgScrMath' (average score in Math) in the 'satscores' table greater than 400. It uses a JOIN to combine data from both tables based on the common 'CDSCode' column.\""
      ]
     },
     "execution_count": 25,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#| echo: true\n",
    "output.explanation"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8123af20",
   "metadata": {},
   "source": [
    ":::\n",
    "\n",
    "\n",
    "\n",
    "--- \n",
    "\n",
    "### LLM generated SQL vs dataset query"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "id": "ae1c1f11",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "\"SELECT COUNT(DISTINCT T2.School) FROM satscores AS T1 INNER JOIN schools AS T2 ON T1.cds = T2.CDSCode WHERE T2.Virtual = 'F' AND T1.AvgScrMath > 400\""
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/plain": [
       "\"SELECT COUNT(*) FROM schools INNER JOIN satscores ON schools.CDSCode = satscores.cds WHERE schools.Virtual = 'Y' AND satscores.AvgScrMath > 400;\""
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "#| echo: true\n",
    "display(query)\n",
    "display(output.sql)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "da9a6a33",
   "metadata": {},
   "source": [
    "Execution result: "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "id": "a6321acf",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"font-weight: bold\">[(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span>,<span style=\"font-weight: bold\">)]</span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[1m[\u001b[0m\u001b[1m(\u001b[0m\u001b[1;36m0\u001b[0m,\u001b[1m)\u001b[0m\u001b[1m]\u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "try:\n",
    "  with engine.connect() as c:\n",
    "    response = c.execute(text(output.sql))\n",
    "    print(response.fetchall())\n",
    "except Exception as err:\n",
    "  print(err)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ead9d2b6",
   "metadata": {},
   "source": [
    "---\n",
    "\n",
    "## Improving the Generation with more context\n",
    "\n",
    "The BIRD mini has some CSV files that help understanding\n",
    "the tables values and relationships\n",
    "\n",
    "We're adding this context in a configuration file, that we will examine in the\n",
    "next section. This is the `evidence` column from the dataset we saw earlier üí°\n",
    "\n",
    "```{.bash}\n",
    " uv run -m sql_with_llms.main ./config-custom.yaml  -c\n",
    "\n",
    "Provider List: https://docs.litellm.ai/docs/providers\n",
    "\n",
    "\n",
    "Provider List: https://docs.litellm.ai/docs/providers\n",
    "\n",
    "Answer: {'sql': \"SELECT COUNT(*) FROM satscores INNER JOIN schools ON satscores.cds = schools.CDSCode WHERE satscores.AvgScrMath > 400 AND schools.Virtual = 'F'\", 'result': '[(4,)]'}\n",
    "```\n",
    "\n",
    "\n",
    "\n",
    "---\n",
    "\n",
    "# Create a workflow\n",
    "\n",
    "::: notes\n",
    "\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "# Chaining generation and execution\n",
    "\n",
    "::: {.fragment .fade-in-then-semi-out}\n",
    "<img src=\"./img/langgraph.svg\" height=\"40px\" style=\"float: left; padding-top: .5em; padding-right: .25em\"/> \n",
    "<p>`LangGraph` allows us to create state machines around LLM calls, using\n",
    "functions as nodes. The full can be checked out [`src/sql_with_llms/main.py`](https://github.com/D3f0/pycon-sql-llm/blob/main/src/sql_with_llms/main.py)</p>\n",
    "\n",
    ":::\n",
    "\n",
    "::: {.incremental}\n",
    "- Memory (cache)\n",
    "- Human in the Loop support\n",
    "- Durable execution\n",
    ":::\n",
    "\n",
    "::: notes\n",
    "We will now put the code we saw into node functions\n",
    "We will have a `Input`, and `Output` a shared `State` and some global configuration, \n",
    "instead of global variables.\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "![](./img/LLMsSQL.svg)\n",
    "\n",
    "\n",
    "---\n",
    "\n",
    "## Graph creation\n",
    "\n",
    "```{.python include=\"src/sql_with_llms/main.py\" snippet=\"graph\" dedent=\"4\" code-line-numbers=\"false\"}\n",
    "```\n",
    "\n",
    "::: {.fragment}\n",
    "Let's take a look at how we define those function and the data types\n",
    "they receive and return\n",
    ":::\n",
    "\n",
    "\n",
    "::: notes\n",
    "1. In Langraph the node functions must be defined before, but we're presenting this\n",
    "   before for clarity\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "```{.python}\n",
    "from sql_with_llms.main import create_graph\n",
    "g.get_graph().draw_png()\n",
    "```\n",
    "\n",
    "![](./img/langraph_graph.png)\n",
    "\n",
    "---\n",
    "\n",
    "\n",
    "\n",
    "## Input class\n",
    "\n",
    "The input and output are these simple dataclasses.\n",
    "\n",
    "::: {.columns}\n",
    "::: {.column}\n",
    "```{.python include=\"src/sql_with_llms/main.py\" snippet=\"input\" code-line-numbers=\"false\"}\n",
    "```\n",
    ":::\n",
    "::: {.column}\n",
    "\n",
    "```{.python include=\"src/sql_with_llms/main.py\" snippet=\"output\" code-line-numbers=\"false\"}\n",
    "```\n",
    "\n",
    ":::\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "## State class\n",
    "\n",
    "This the state passed between the **inner**.\n",
    "The first and last one will receive/return the `Input`/`Output` respectively.\n",
    "\n",
    "```{.python include=\"src/sql_with_llms/main.py\" snippet=\"state\" code-line-numbers=\"false\"}\n",
    "```\n",
    "\n",
    "---\n",
    "\n",
    "## The init node function\n",
    "\n",
    "This node consumes the input converting the something of shape `Input` into\n",
    "a `State`. The next node will be prompt generation, so we will be save the\n",
    "`question`.\n",
    "\n",
    "```{.python include=\"src/sql_with_llms/main.py\" snippet=\"init\" code-line-numbers=\"false\"}\n",
    "```\n",
    "\n",
    "---\n",
    "\n",
    "## Global configuration class {.smaller}\n",
    "\n",
    "The nodes beyond the initial one will require to have a bit more information\n",
    "that won't change (not considered state). We will provide this as a seconds argument \n",
    "and bind it with `functools.partial`. \n",
    "\n",
    "```{.python include=\"src/sql_with_llms/main.py\" snippet=\"cfg\" code-line-numbers=\"false\"}\n",
    "```\n",
    "\n",
    "\n",
    "---\n",
    "\n",
    "## Prompt generation function node\n",
    "\n",
    "```{.python include=\"src/sql_with_llms/main.py\" snippet=\"prompt_gen\" code-line-numbers=\"false\"}\n",
    "```\n",
    "\n",
    "---\n",
    "\n",
    "\n",
    "![](./img/LLMsSQL.svg)\n",
    "\n",
    "\n",
    "---\n",
    "\n",
    "## LLM calling function node\n",
    "\n",
    "\n",
    "```{.python include=\"src/sql_with_llms/main.py\" snippet=\"call_llm\" code-line-numbers=\"false\"}\n",
    "```\n",
    "\n",
    "\n",
    "## SQL Execution function node\n",
    "\n",
    "```{.python include=\"src/sql_with_llms/main.py\" snippet=\"exec_sql\" code-line-numbers=\"false\"}\n",
    "```\n",
    "\n",
    "---\n",
    "\n",
    "## Running the code\n",
    "\n",
    "```{.bash}\n",
    "git clone https://github.com/D3f0/pycon-sql-llm.git\n",
    "uv sync\n",
    "uv run -m sql_with_llms.main \n",
    "```\n",
    "\n",
    "---\n",
    "\n",
    "# Lessons learned\n",
    "\n",
    "---\n",
    "\n",
    "### Lessons learned \n",
    "\n",
    "::: {.fragment}\n",
    "- Tables with a high number of columns can make the context larger\n",
    "  - RAG at the column level is a common technique to improve efficiency and accuracy.\n",
    ":::\n",
    "::: {.fragment}\n",
    "- SQL manipulation at the abstract syntax tree level (`sqlglot`)\n",
    "  - Finding dangerous operations (DML)\n",
    "  - Value substitution \n",
    ":::\n",
    "\n",
    "\n",
    "::: notes\n",
    "Also we can pass the SQL to SQLAlchemy engine to validate if the syntax is correct\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "### Lessons learned  (cont.)\n",
    "\n",
    "::: {.fragment}\n",
    "- Please more context!\n",
    "  - Adding examples, but not too many, or only the relevant ones ü§î\n",
    ":::\n",
    "\n",
    "::: {.fragment}\n",
    "- Dynamic context\n",
    "\n",
    "  - date based\n",
    "  - external resources\n",
    "  - AI tools\n",
    ":::\n",
    "\n",
    "\n",
    "::: footer\n",
    "For example, the term Q1 can mean, *quarter one*, but it should\n",
    "    be supplied dynamically\n",
    ":::\n",
    "---\n",
    "\n",
    "### Lessons learned (cont.)\n",
    "\n",
    "::: {.fragment}\n",
    "- Function nodes\n",
    "  - Custom modifications\n",
    "  - Security (Python on WASM)\n",
    ":::\n",
    "\n",
    "---\n",
    "\n",
    "### Closing words\n",
    "\n",
    "::: {.fragment}\n",
    "- [Agentics](https://pypi.org/project/agentics-py/){target=\"_blank\"} is an OSS frameworks for writing agents created at IBM Research\n",
    "  - Example of text2sql [use case](https://github.com/IBM/Agentics/tree/main/applications/text2sql){target=\"_blank\"}\n",
    ":::\n",
    "\n",
    "::: notes\n",
    "\n",
    ":::\n",
    "---\n",
    "\n",
    "\n",
    "## Thank you & Questions{.center}\n",
    "\n",
    "::: {.columns }\n",
    "::: {.column width=\"36%\"}\n",
    ":::\n",
    "::: {.column width=\"30%\"}\n",
    "{{< qrcode https://d3f0.github.io/pycon-sql-llm/slides.html#/title-slide qr2 width=400 height=400 colorDark='#0011bb' >}}\n",
    ":::\n",
    "::: {.column width=\"30%\"}\n",
    ":::\n",
    ":::\n",
    "\n",
    "::: {style=\"text-align: center; \"}\n",
    "{{< bi envelope >}} [nahuel.defosse@ibm.com](mailto:nahuel.defosse@ibm.com)\n",
    ":::"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3",
   "path": "/Users/nahueldefosse/workspace/slides/pycon-2025-insights-from-sql-llms/.venv/share/jupyter/kernels/python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.11"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
